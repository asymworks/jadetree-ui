@use 'util/base.scss';
@use 'util/mixins.scss';

@use 'listbox.scss';

jt-autocomplete {
    position: relative;
    display: inline-block;
    color: var(--_jt-control-color);
    background-color: var(--_jt-control-background);

    @include mixins.jt-control;

    /* 
        Chrome still shows the drop-down arrow after 
        removal of "list" attribute. Bad Google.
    */
    input::-webkit-calendar-picker-indicator {
        display: none;
        opacity: 0;
    }

    button[data-action="close"] {
        @include mixins.back-button;
        display: none;
    }

    button[data-action="open"] {
        @include mixins.arrow-button;
    }

    button[data-action="clear"] {
        display: none;
        @include mixins.clear-button;
    }

    &[clearable] button[data-action="clear"] {
        display: block;
    }

    &.jt-placeholder-shown button[data-action="clear"] {
        display: none;
    }

    .jt-popup {
        visibility: hidden;
        position: absolute;
        inset: auto 0;
        border: 1px solid var(--_jt-control-border-color);
        border-end-start-radius: var(--_jt-control-border-radius);
        border-end-end-radius: var(--_jt-control-border-radius);
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 20%);

        &:last-child {
            border-end-start-radius: var(--_jt-control-border-radius);
            border-end-end-radius: var(--_jt-control-border-radius);
        }
    }

    &.jt-open .jt-popup {
        visibility: visible;
    }

    &.jt-open .jt-control {
        border-block-end: none;
        border-end-start-radius: 0;
        border-end-end-radius: 0;
    }

    @media not (pointer: fine), (max-width: 640px) {
        &.jt-open {
            position: fixed;
            inset: 0;
            display: block;

            button[data-action="close"] {
                display: block;
                margin-inline: 0.25rem;
            }

            button[data-action="open"] {
                display: none;
            }

            .jt-control,
            .jt-control:focus-within,
            .jt-control:hover {
                border: none;
                border-bottom: 1px solid var(--_jt-control-border-color);
                border-radius: 0;
                outline: none;
                padding-block: 0.2em;
                margin-block-start: 0.2em;
            }

            .jt-popup {
                border: none;
                box-shadow: none;

                .jt-listbox {
                    max-block-size: 100%;
                }
            }

            .jt-listbox__item[role=option],
            .jt-listbox__item[role=presentation] {
                padding: 0.4em;
            }
        }
    }

    .jt-listbox__item mark {
        background-color: inherit;
        color: inherit;
        font-weight: bold;
    }
}

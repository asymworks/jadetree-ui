/*! JtControls v0.2.2 | (c) 2023 Jonathan Krauss | BSD-3-Clause License | git+https://github.com/asymworks/jadetree-ui.git */
var JtControls=function(){"use strict";function t(t){return t.split("-")[1]}function n(t){return"y"===t?"height":"width"}function e(t){return t.split("-")[0]}function o(t){return["top","bottom"].includes(e(t))?"x":"y"}function i(i,r,s){let{reference:a,floating:c}=i;const l=a.x+a.width/2-c.width/2,u=a.y+a.height/2-c.height/2,f=o(r),d=n(f),h=a[d]/2-c[d]/2,p="x"===f;let m;switch(e(r)){case"top":m={x:l,y:a.y-c.height};break;case"bottom":m={x:l,y:a.y+a.height};break;case"right":m={x:a.x+a.width,y:u};break;case"left":m={x:a.x-c.width,y:u};break;default:m={x:a.x,y:a.y}}switch(t(r)){case"start":m[f]-=h*(s&&p?-1:1);break;case"end":m[f]+=h*(s&&p?-1:1)}return m}function r(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}async function s(t,n){var e;void 0===n&&(n={});const{x:o,y:i,platform:s,rects:a,elements:c,strategy:l}=t,{boundary:u="clippingAncestors",rootBoundary:f="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=n,m=function(t){return"number"!=typeof t?function(t){return{top:0,right:0,bottom:0,left:0,...t}}(t):{top:t,right:t,bottom:t,left:t}}(p),y=c[h?"floating"===d?"reference":"floating":d],g=r(await s.getClippingRect({element:null==(e=await(null==s.isElement?void 0:s.isElement(y)))||e?y:y.contextElement||await(null==s.getDocumentElement?void 0:s.getDocumentElement(c.floating)),boundary:u,rootBoundary:f,strategy:l})),x="floating"===d?{...a.floating,x:o,y:i}:a.reference,w=await(null==s.getOffsetParent?void 0:s.getOffsetParent(c.floating)),v=await(null==s.isElement?void 0:s.isElement(w))&&await(null==s.getScale?void 0:s.getScale(w))||{x:1,y:1},b=r(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({rect:x,offsetParent:w,strategy:l}):x);return{top:(g.top-b.top+m.top)/v.y,bottom:(b.bottom-g.bottom+m.bottom)/v.y,left:(g.left-b.left+m.left)/v.x,right:(b.right-g.right+m.right)/v.x}}const a=Math.min,c=Math.max;function l(t,n,e){return c(t,a(n,e))}const u={left:"right",right:"left",bottom:"top",top:"bottom"};function f(t){return t.replace(/left|right|bottom|top/g,(t=>u[t]))}const d={start:"end",end:"start"};function h(t){return t.replace(/start|end/g,(t=>d[t]))}const p=function(i){return void 0===i&&(i={}),{name:"flip",options:i,async fn(r){var a;const{placement:c,middlewareData:l,rects:u,initialPlacement:d,platform:p,elements:m}=r,{mainAxis:y=!0,crossAxis:g=!0,fallbackPlacements:x,fallbackStrategy:w="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:b=!0,...A}=i,k=e(c),T=e(d)===d,R=await(null==p.isRTL?void 0:p.isRTL(m.floating)),M=x||(T||!b?[f(d)]:function(t){const n=f(t);return[h(t),n,h(n)]}(d));x||"none"===v||M.push(...function(n,o,i,r){const s=t(n);let a=function(t,n,e){const o=["left","right"],i=["right","left"],r=["top","bottom"],s=["bottom","top"];switch(t){case"top":case"bottom":return e?n?i:o:n?o:i;case"left":case"right":return n?r:s;default:return[]}}(e(n),"start"===i,r);return s&&(a=a.map((t=>t+"-"+s)),o&&(a=a.concat(a.map(h)))),a}(d,b,v,R));const S=[d,...M],E=await s(r,A),C=[];let F=(null==(a=l.flip)?void 0:a.overflows)||[];if(y&&C.push(E[k]),g){const{main:e,cross:i}=function(e,i,r){void 0===r&&(r=!1);const s=t(e),a=o(e),c=n(a);let l="x"===a?s===(r?"end":"start")?"right":"left":"start"===s?"bottom":"top";return i.reference[c]>i.floating[c]&&(l=f(l)),{main:l,cross:f(l)}}(c,u,R);C.push(E[e],E[i])}if(F=[...F,{placement:c,overflows:C}],!C.every((t=>t<=0))){var _,L;const t=((null==(_=l.flip)?void 0:_.index)||0)+1,n=S[t];if(n)return{data:{index:t,overflows:F},reset:{placement:n}};let e=null==(L=F.filter((t=>t.overflows[0]<=0)).sort(((t,n)=>t.overflows[1]-n.overflows[1]))[0])?void 0:L.placement;if(!e)switch(w){case"bestFit":{var j;const t=null==(j=F.map((t=>[t.placement,t.overflows.filter((t=>t>0)).reduce(((t,n)=>t+n),0)])).sort(((t,n)=>t[1]-n[1]))[0])?void 0:j[0];t&&(e=t);break}case"initialPlacement":e=d}if(c!==e)return{reset:{placement:e}}}return{}}}};const m=function(n){return void 0===n&&(n=0),{name:"offset",options:n,async fn(i){const{x:r,y:s}=i,a=await async function(n,i){const{placement:r,platform:s,elements:a}=n,c=await(null==s.isRTL?void 0:s.isRTL(a.floating)),l=e(r),u=t(r),f="x"===o(r),d=["left","top"].includes(l)?-1:1,h=c&&f?-1:1,p="function"==typeof i?i(n):i;let{mainAxis:m,crossAxis:y,alignmentAxis:g}="number"==typeof p?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...p};return u&&"number"==typeof g&&(y="end"===u?-1*g:g),f?{x:y*h,y:m*d}:{x:m*d,y:y*h}}(i,n);return{x:r+a.x,y:s+a.y,data:a}}}};function y(t){var n;return(null==(n=t.ownerDocument)?void 0:n.defaultView)||window}function g(t){return y(t).getComputedStyle(t)}function x(t){return t instanceof y(t).Node}function w(t){return x(t)?(t.nodeName||"").toLowerCase():""}function v(t){return t instanceof y(t).HTMLElement}function b(t){return t instanceof y(t).Element}function A(t){if("undefined"==typeof ShadowRoot)return!1;return t instanceof y(t).ShadowRoot||t instanceof ShadowRoot}function k(t){const{overflow:n,overflowX:e,overflowY:o,display:i}=g(t);return/auto|scroll|overlay|hidden|clip/.test(n+o+e)&&!["inline","contents"].includes(i)}function T(t){return["table","td","th"].includes(w(t))}function R(t){const n=M(),e=g(t);return"none"!==e.transform||"none"!==e.perspective||!n&&!!e.backdropFilter&&"none"!==e.backdropFilter||!n&&!!e.filter&&"none"!==e.filter||["transform","perspective","filter"].some((t=>(e.willChange||"").includes(t)))||["paint","layout","strict","content"].some((t=>(e.contain||"").includes(t)))}function M(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function S(t){return["html","body","#document"].includes(w(t))}const E=Math.min,C=Math.max,F=Math.round;function _(t){const n=g(t);let e=parseFloat(n.width)||0,o=parseFloat(n.height)||0;const i=v(t),r=i?t.offsetWidth:e,s=i?t.offsetHeight:o,a=F(e)!==r||F(o)!==s;return a&&(e=r,o=s),{width:e,height:o,fallback:a}}function L(t){return b(t)?t:t.contextElement}const j={x:1,y:1};function P(t){const n=L(t);if(!v(n))return j;const e=n.getBoundingClientRect(),{width:o,height:i,fallback:r}=_(n);let s=(r?F(e.width):e.width)/o,a=(r?F(e.height):e.height)/i;return s&&Number.isFinite(s)||(s=1),a&&Number.isFinite(a)||(a=1),{x:s,y:a}}const $={x:0,y:0};function O(t,n,e){var o,i;if(void 0===n&&(n=!0),!M())return $;const r=t?y(t):window;return!e||n&&e!==r?$:{x:(null==(o=r.visualViewport)?void 0:o.offsetLeft)||0,y:(null==(i=r.visualViewport)?void 0:i.offsetTop)||0}}function D(t,n,e,o){void 0===n&&(n=!1),void 0===e&&(e=!1);const i=t.getBoundingClientRect(),s=L(t);let a=j;n&&(o?b(o)&&(a=P(o)):a=P(t));const c=O(s,e,o);let l=(i.left+c.x)/a.x,u=(i.top+c.y)/a.y,f=i.width/a.x,d=i.height/a.y;if(s){const t=y(s),n=o&&b(o)?y(o):o;let e=t.frameElement;for(;e&&o&&n!==t;){const t=P(e),n=e.getBoundingClientRect(),o=getComputedStyle(e);n.x+=(e.clientLeft+parseFloat(o.paddingLeft))*t.x,n.y+=(e.clientTop+parseFloat(o.paddingTop))*t.y,l*=t.x,u*=t.y,f*=t.x,d*=t.y,l+=n.x,u+=n.y,e=y(e).frameElement}}return r({width:f,height:d,x:l,y:u})}function q(t){return((x(t)?t.ownerDocument:t.document)||window.document).documentElement}function z(t){return b(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function B(t){return D(q(t)).left+z(t).scrollLeft}function H(t){if("html"===w(t))return t;const n=t.assignedSlot||t.parentNode||A(t)&&t.host||q(t);return A(n)?n.host:n}function I(t){const n=H(t);return S(n)?n.ownerDocument.body:v(n)&&k(n)?n:I(n)}function N(t,n){var e;void 0===n&&(n=[]);const o=I(t),i=o===(null==(e=t.ownerDocument)?void 0:e.body),r=y(o);return i?n.concat(r,r.visualViewport||[],k(o)?o:[]):n.concat(o,N(o))}function V(t,n,e){let o;if("viewport"===n)o=function(t,n){const e=y(t),o=q(t),i=e.visualViewport;let r=o.clientWidth,s=o.clientHeight,a=0,c=0;if(i){r=i.width,s=i.height;const t=M();(!t||t&&"fixed"===n)&&(a=i.offsetLeft,c=i.offsetTop)}return{width:r,height:s,x:a,y:c}}(t,e);else if("document"===n)o=function(t){const n=q(t),e=z(t),o=t.ownerDocument.body,i=C(n.scrollWidth,n.clientWidth,o.scrollWidth,o.clientWidth),r=C(n.scrollHeight,n.clientHeight,o.scrollHeight,o.clientHeight);let s=-e.scrollLeft+B(t);const a=-e.scrollTop;return"rtl"===g(o).direction&&(s+=C(n.clientWidth,o.clientWidth)-i),{width:i,height:r,x:s,y:a}}(q(t));else if(b(n))o=function(t,n){const e=D(t,!0,"fixed"===n),o=e.top+t.clientTop,i=e.left+t.clientLeft,r=v(t)?P(t):{x:1,y:1};return{width:t.clientWidth*r.x,height:t.clientHeight*r.y,x:i*r.x,y:o*r.y}}(n,e);else{const e=O(t);o={...n,x:n.x-e.x,y:n.y-e.y}}return r(o)}function G(t,n){const e=H(t);return!(e===n||!b(e)||S(e))&&("fixed"===g(e).position||G(e,n))}function J(t,n){return v(t)&&"fixed"!==g(t).position?n?n(t):t.offsetParent:null}function U(t,n){const e=y(t);if(!v(t))return e;let o=J(t,n);for(;o&&T(o)&&"static"===g(o).position;)o=J(o,n);return o&&("html"===w(o)||"body"===w(o)&&"static"===g(o).position&&!R(o))?e:o||function(t){let n=H(t);for(;v(n)&&!S(n);){if(R(n))return n;n=H(n)}return null}(t)||e}function W(t,n,e){const o=v(n),i=q(n),r="fixed"===e,s=D(t,!0,r,n);let a={scrollLeft:0,scrollTop:0};const c={x:0,y:0};if(o||!o&&!r)if(("body"!==w(n)||k(i))&&(a=z(n)),v(n)){const t=D(n,!0,r,n);c.x=t.x+n.clientLeft,c.y=t.y+n.clientTop}else i&&(c.x=B(i));return{x:s.left+a.scrollLeft-c.x,y:s.top+a.scrollTop-c.y,width:s.width,height:s.height}}const X={getClippingRect:function(t){let{element:n,boundary:e,rootBoundary:o,strategy:i}=t;const r=[..."clippingAncestors"===e?function(t,n){const e=n.get(t);if(e)return e;let o=N(t).filter((t=>b(t)&&"body"!==w(t))),i=null;const r="fixed"===g(t).position;let s=r?H(t):t;for(;b(s)&&!S(s);){const n=g(s),e=R(s);e||"fixed"!==n.position||(i=null),(r?!e&&!i:!e&&"static"===n.position&&i&&["absolute","fixed"].includes(i.position)||k(s)&&!e&&G(t,s))?o=o.filter((t=>t!==s)):i=n,s=H(s)}return n.set(t,o),o}(n,this.t):[].concat(e),o],s=r[0],a=r.reduce(((t,e)=>{const o=V(n,e,i);return t.top=C(o.top,t.top),t.right=E(o.right,t.right),t.bottom=E(o.bottom,t.bottom),t.left=C(o.left,t.left),t}),V(n,s,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},convertOffsetParentRelativeRectToViewportRelativeRect:function(t){let{rect:n,offsetParent:e,strategy:o}=t;const i=v(e),r=q(e);if(e===r)return n;let s={scrollLeft:0,scrollTop:0},a={x:1,y:1};const c={x:0,y:0};if((i||!i&&"fixed"!==o)&&(("body"!==w(e)||k(r))&&(s=z(e)),v(e))){const t=D(e);a=P(e),c.x=t.x+e.clientLeft,c.y=t.y+e.clientTop}return{width:n.width*a.x,height:n.height*a.y,x:n.x*a.x-s.scrollLeft*a.x+c.x,y:n.y*a.y-s.scrollTop*a.y+c.y}},isElement:b,getDimensions:function(t){return _(t)},getOffsetParent:U,getDocumentElement:q,getScale:P,async getElementRects(t){let{reference:n,floating:e,strategy:o}=t;const i=this.getOffsetParent||U,r=this.getDimensions;return{reference:W(n,await i(e),o),floating:{x:0,y:0,...await r(e)}}},getClientRects:t=>Array.from(t.getClientRects()),isRTL:t=>"rtl"===g(t).direction};const Y=(t,n,e)=>{const o=new Map,r={platform:X,...e},s={...r.platform,t:o};return(async(t,n,e)=>{const{placement:o="bottom",strategy:r="absolute",middleware:s=[],platform:a}=e,c=s.filter(Boolean),l=await(null==a.isRTL?void 0:a.isRTL(n));let u=await a.getElementRects({reference:t,floating:n,strategy:r}),{x:f,y:d}=i(u,o,l),h=o,p={},m=0;for(let e=0;e<c.length;e++){const{name:s,fn:y}=c[e],{x:g,y:x,data:w,reset:v}=await y({x:f,y:d,initialPlacement:o,placement:h,strategy:r,middlewareData:p,rects:u,platform:a,elements:{reference:t,floating:n}});f=null!=g?g:f,d=null!=x?x:d,p={...p,[s]:{...p[s],...w}},v&&m<=50&&(m++,"object"==typeof v&&(v.placement&&(h=v.placement),v.rects&&(u=!0===v.rects?await a.getElementRects({reference:t,floating:n,strategy:r}):v.rects),({x:f,y:d}=i(u,h,l))),e=-1)}return{x:f,y:d,placement:h,strategy:r,middlewareData:p}})(t,n,{...r,platform:s})},K=new Map,Q="rtl"===window.getComputedStyle(document.documentElement).direction,Z={LEFT:37,UP:38,RIGHT:39,DOWN:40},tt=t=>{const{currentTarget:n}=t;K.get("last_rover")!=n&&K.has(n)&&(rt(n,K.get(n).active),K.set("last_rover",n))},nt=t=>{const{currentTarget:n}=t;switch(t.keyCode){case Z[Q?"LEFT":"RIGHT"]:case Z.DOWN:t.preventDefault(),ot(n);break;case Z[Q?"RIGHT":"LEFT"]:case Z.UP:t.preventDefault(),it(n)}},et=new MutationObserver(((t,n)=>{t.filter((t=>t.removedNodes.length>0)).forEach((t=>{[...t.removedNodes].filter((t=>1===t.nodeType)).forEach((t=>{K.forEach(((n,e)=>{"last_rover"!==e&&t.contains(e)&&(e.removeEventListener("focusin",tt),e.removeEventListener("keydown",nt),K.delete(e),n.targets.forEach((t=>t.tabIndex="")),(0===K.size||1===K.size&&K.has("last_rover"))&&(K.clear(),et.disconnect()))}))}))}))})),ot=t=>{const n=K.get(t);n.index+=1,n.index>n.targets.length-1&&(n.index=n.targets.length-1);let e=n.targets[n.index];e&&rt(t,e)},it=t=>{const n=K.get(t);n.index-=1,n.index<1&&(n.index=0);let e=n.targets[n.index];e&&rt(t,e)},rt=(t,n)=>{const e=K.get(t);e.active.tabIndex=-1,e.active=n,e.active.tabIndex=0,e.active.focus()};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var st={};({get exports(){return st},set exports(t){st=t}}).exports=function(){var t={length:32,template:"%qinu%",dict:"1234567890abcdefghijklmnopqrstuvwxyz",random:!1},n=function(t,e){if(!t.length)return"";var o=e.indexOf(t.slice(-1));return o+1<e.length?t.slice(0,-1)+e[o+1]:n(t.slice(0,-1),e)+e[0]},e=function(t,n,o){if(void 0===o&&(o=""),o.length>=n)return o;var i=t[Math.floor(Math.random()*t.length)];return e(t,n,o+i)},o=function(t,n,e){return e.reduce((function(t,n,e){return t.replace(new RegExp("%arg\\["+e+"\\]%","g"),n)}),t.replace(/%qinu%/g,n))},i=function(n){return n||0===n?"object"!=typeof n&&(n={length:+n}):n={},(n=Object.assign({},t,n)).dict&&(n.dict=n.dict.split("").sort().filter((function(t,n,e){return e[n-1]!==t})).join("")),n},r=function(){};function s(t,n){var s=this instanceof r?t:i(t),a=s.dict,c=s.length,l=s.template,u=s.args,f=s.random;n instanceof Array||(n=Array.prototype.slice.call(arguments,1)),u instanceof Array&&(n=u.concat(n));var d=!f&&this instanceof r?this.next(a,c):e(a,c);return o(l,d,n)}return r.prototype.next=function(t,o){var i=this.key||e(t,o);return this.key=n(i,t),this.key},s.create=function(t){return s.bind(new r,i(t))},s}();var at=st.create({length:6,template:"%arg[0]%-%qinu%"});class ct extends HTMLElement{o(t){t.currentTarget instanceof Element&&t.currentTarget.closest(`#${this.i}`)&&(this.open(),this.l())}u(t){t.currentTarget instanceof Element&&t.currentTarget.closest(`#${this.i}`)&&this.close()}l(){const t=this.getAttribute("alignment")||"center",n=this.getAttribute("placement")||"right";this.h=this.getAttribute("offset")?parseInt(this.getAttribute("offset")):null,this.p=`${n}${"center"!==t?"-"+t:""}`,this.m=this.getAttribute("selector")||"button",this.g&&this.v&&function(t,n,e,o){void 0===o&&(o={});const{ancestorScroll:i=!0,ancestorResize:r=!0,elementResize:s=!0,animationFrame:a=!1}=o,c=i||r?[...b(t)?N(t):t.contextElement?N(t.contextElement):[],...N(n)]:[];c.forEach((t=>{const n=!b(t)&&t.toString().includes("V");!i||a&&!n||t.addEventListener("scroll",e,{passive:!0}),r&&t.addEventListener("resize",e)}));let l,u=null;s&&(u=new ResizeObserver((()=>{e()})),b(t)&&!a&&u.observe(t),b(t)||!t.contextElement||a||u.observe(t.contextElement),u.observe(n));let f=a?D(t):null;a&&function n(){const o=D(t);!f||o.x===f.x&&o.y===f.y&&o.width===f.width&&o.height===f.height||e(),f=o,l=requestAnimationFrame(n)}(),e()}(this.g,this.v,(()=>{var t;Y(this.g,this.v,{placement:this.p,middleware:[p(),(void 0===t&&(t={}),{name:"shift",options:t,async fn(n){const{x:i,y:r,placement:a}=n,{mainAxis:c=!0,crossAxis:u=!1,limiter:f={fn:t=>{let{x:n,y:e}=t;return{x:n,y:e}}},...d}=t,h={x:i,y:r},p=await s(n,d),m=o(e(a)),y="x"===m?"y":"x";let g=h[m],x=h[y];if(c){const t="y"===m?"bottom":"right";g=l(g+p["y"===m?"top":"left"],g,g-p[t])}if(u){const t="y"===y?"bottom":"right";x=l(x+p["y"===y?"top":"left"],x,x-p[t])}const w=f.fn({...n,[m]:g,[y]:x});return{...w,data:{x:w.x-i,y:w.y-r}}}}),this.h&&m(this.h)]}).then((({x:t,y:n})=>{Object.assign(this.v.style,{left:`${t}px`,top:`${n}px`})}))}))}A(){if(!this.isConnected)return;this.hasAttribute("id")||this.setAttribute("id",this.i),this.g=this.querySelector("[slot=trigger]"),this.v=this.querySelector("[slot=target]"),this.v.classList.add("jt-popup__popup"),this.v.hasAttribute("id")||this.v.setAttribute("id",`${this.i}-menu`);const t=document.createElement("div");t.classList.add("jt-popup"),t.setAttribute("aria-haspopup","true"),t.setAttribute("aria-controls",this.v.getAttribute("id")),t.setAttribute("aria-expanded","false"),t.appendChild(this.g),t.appendChild(this.v),this.appendChild(t),(({element:t,target:n})=>{const e=t.querySelectorAll(n||":scope *"),o=e[0];t.tabIndex=-1,e.forEach((t=>t.tabIndex=-1)),o.tabIndex=0,K.set(t,{targets:e,active:o,index:0}),t.addEventListener("focusin",tt),t.addEventListener("keydown",nt),et.observe(document,{childList:!0,subtree:!0})})({element:t,target:`[slot=target] ${this.m}`}),t.addEventListener("focusin",(t=>this.o(t))),t.addEventListener("focusout",(t=>this.u(t))),t.addEventListener("keyup",(t=>"Escape"===t.code&&t.target instanceof HTMLElement&&t.target.blur())),this.g.setAttribute("tabindex","-1"),this.g.addEventListener("click",(()=>{const t=this.querySelector(`[slot=target] ${this.m}`);t instanceof HTMLElement&&t.focus()}))}close(){this.querySelector("div").setAttribute("aria-expanded","false")}open(){this.querySelector("div").setAttribute("aria-expanded","true")}constructor(){super(),this.i=this.getAttribute("id")||at("jt-popup-menu")}static get observedAttributes(){return["alignment","placement","offset"]}attributeChangedCallback(t){switch(t){case"alignment":case"placement":case"offset":this.l()}}connectedCallback(){setTimeout((()=>this.A()),0)}static register(){customElements.define("jt-popup-menu",ct)}}return ct.register(),ct}();

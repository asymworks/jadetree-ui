/*! JtControls v0.1.16 | (c) 2023 Jonathan Krauss | BSD-3-Clause License | git+https://github.com/asymworks/jadetree-ui.git */
var JtControls=function(){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t={};({get exports(){return t},set exports(s){t=s}}).exports=function(){var t={length:32,template:"%qinu%",dict:"1234567890abcdefghijklmnopqrstuvwxyz",random:!1},s=function(t,e){if(!t.length)return"";var i=e.indexOf(t.slice(-1));return i+1<e.length?t.slice(0,-1)+e[i+1]:s(t.slice(0,-1),e)+e[0]},e=function(t,s,i){if(void 0===i&&(i=""),i.length>=s)return i;var h=t[Math.floor(Math.random()*t.length)];return e(t,s,i+h)},i=function(t,s,e){return e.reduce((function(t,s,e){return t.replace(new RegExp("%arg\\["+e+"\\]%","g"),s)}),t.replace(/%qinu%/g,s))},h=function(s){return s||0===s?"object"!=typeof s&&(s={length:+s}):s={},(s=Object.assign({},t,s)).dict&&(s.dict=s.dict.split("").sort().filter((function(t,s,e){return e[s-1]!==t})).join("")),s},n=function(){};function r(t,s){var r=this instanceof n?t:h(t),o=r.dict,a=r.length,l=r.template,c=r.args,u=r.random;s instanceof Array||(s=Array.prototype.slice.call(arguments,1)),c instanceof Array&&(s=c.concat(s));var d=!u&&this instanceof n?this.next(o,a):e(o,a);return i(l,d,s)}return n.prototype.next=function(t,i){var h=this.key||e(t,i);return this.key=s(h,t),this.key},r.create=function(t){return r.bind(new n,h(t))},r}();const s=t.create({length:6,template:"%arg[0]%-%qinu%"}),e=function(){if(!window.DOMParser)return!1;try{(new DOMParser).parseFromString("x","text/html")}catch(t){return!1}return!0}();function i(t){if(e){const s=(new DOMParser).parseFromString(t,"text/html");return s.body.firstElementChild instanceof Element?s.body.firstElementChild:s.body}const s=document.createElement("div");return s.innerHTML=t,s.firstElementChild instanceof Element?s.firstElementChild:s}function h(t,s){let e=t.nextElementSibling;for(;e;){if(s(e))return e;e=e.nextElementSibling}return e}function n(t,s,e){var i;return!(!t||!t.hasAttribute(s))&&(!(null==e?void 0:e.aria)&&!s.toLowerCase().startsWith("aria-")||"true"===(null===(i=t.getAttribute(s))||void 0===i?void 0:i.toLowerCase()))}class r{[Symbol.iterator](){return this.values()}get length(){return this.t.length}get value(){return this.t.join(" ")}set value(t){if(t){const s=(t||"").split(" ").map((t=>t.trim())),e=s.filter((t=>!this.t.includes(t))),i=this.t.filter((t=>!s.includes(t)));e.length>0&&this.i("add",...e),i.length>0&&this.i("remove",...i)}else this.t.length>0&&this.i("remove",...this.t),this.t=[]}add(...t){const s=t.filter((t=>!this.t.includes(t)));s.length>0&&(this.t.push(...s),this.i("add",...s))}contains(t){return this.t.includes(t)}entries(){return this.t.entries()}forEach(t,s){const e=t.bind(s);for(const[t,s]of this.entries())e(s,t,this)}item(t){return t<0||t>=this.length?null:this.t.at(t)}keys(){return this.t.keys()}remove(...t){const s=t.filter((t=>this.t.includes(t)));s.length>0&&(this.t=this.t.filter((t=>!s.includes(t))),this.i("remove",...s))}replace(t,s){const e=this.t.indexOf(t);if(-1===e)return!1;this.t[e]=s,this.i("remove",t),this.i("add",s)}supports(t){return!0}toggle(t,s){return this.contains(t)||void 0!==s&&!s?!this.contains(t)||void 0!==s&&s||this.remove(t):this.add(t),this.contains(t)}values(){return this.t.values()}constructor(t,s){this.i=t,this.t=s||[]}}const o=t=>s(`${t}-item`),a=t=>t.searchRegex&&t.label&&!t.empty?t.label.replace(t.searchRegex,"<mark>$&</mark>"):t.creating?`Press enter to create <mark>${t.searchString}</mark>`:t.empty?t.searchString||t.label?"No Items Found":"No Items":t.label||"",l=t=>t.label||"",c={canSelect:!0,cursorTimeout:150,filterRegex:t=>new RegExp(`\\b(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"i"),pageSize:10,type:"single"};class u{h(){if(!this.o)return;const t=this.l.querySelector(`#${this.o}`);t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}u(t){const s=`<ul class="jt-listbox" role="listbox" id="${this.p}" data-type="${this.m.type}"></ul>`;if(this.l=i(s),this.l.classList.add(...this.g.values()),"number"==typeof this.m.tabIndex&&this.l.setAttribute("tabindex",`${this.m.tabIndex}`),t instanceof HTMLElement)for(const s of t.children)if(s instanceof HTMLOptionElement||s instanceof HTMLOptGroupElement){if("placeholder"===s.dataset.role)continue;this.add(s)}else 3!==s.nodeType&&console.warn(`Unexpected element ${s.nodeName.toLowerCase()} in <${t.nodeName.toLowerCase()}>`);else Array.isArray(t)?t.forEach((t=>this.add(t))):console.error(`Unexpected type "${typeof t}" provided to _createDom`,t);const e=i(`<li class="jt-listbox__item" id="${this.p}-empty" data-empty="true" aria-hidden="true" hidden="true"></li>`);return e.classList.add(...this.v.values()),this.m.canCreate?e.setAttribute("role","option"):e.setAttribute("role","presentation"),this._(e),this.l.append(e),this.$(),this.l}L(t,s=!1){const e=t.key?t.key:o(this.p);document.querySelector(`#${e}`)&&!s&&console.error(`An element with key ${e} already exists.`);const{label:h,group:n,disabled:r,data:a}=t;h||console.warn("Label for <optgroup> is empty");const l=i(`\n<li class="jt-listbox__group" id="${e}">\n    <ul role="group" aria-labelledby="${e}-hdr">\n        <li role="presentation" class="jt-listbox__item jt-listbox__item--header" data-label="${h}" id="${e}-hdr"></li>\n    </ul>\n</li>`);l.classList.add(...this.T.values()),Object.keys(a||{}).length&&(l.dataset.itemData=JSON.stringify(a)),r&&l.setAttribute("aria-disabled","true");const c=l.querySelector('ul[role="group"]');if(!c)throw new Error("_createGroup did not render a ul[role=group]");const u=l.querySelector("li[role=presentation]");if(u.classList.add(...this.j.values()),!u)throw new Error("_createGroup did not render a li[role=presentation]");return u.dataset.groupId=e,u.dataset.itemData=JSON.stringify(a),this._(u),null==n||n.forEach((t=>{t.group?console.error("Nested option groups are not allowed"):c.append(this.k(t))})),l}k(t,s=!1){const e=t.key?t.key:o(this.p);document.querySelector(`#${e}`)&&!s&&console.error(`An element with key ${e} already exists.`);const{label:h,value:n,disabled:r,separator:a,data:l}=t;if(a){const t=i(`<li class="jt-listbox__item" id="${e}" role="separator"></li>`);return t.classList.add(...this.v.values()),t.dataset.itemData=JSON.stringify(l),this._(t),t}h||n||console.warn("Neither label nor value was specified for <option>"),this.l.querySelector(`[data-value="${n||h}"]`)&&!s&&console.warn(`An element with value ${n||h} already exists.`);const c=i(`<li class="jt-listbox__item" id="${e}" data-value="${n||h}" data-label="${h||n}" role="option"></li>`);return c.classList.add(...this.v.values()),Object.keys(l||{}).length&&(c.dataset.itemData=JSON.stringify(l)),l&&l.searchLabel&&(c.dataset.searchLabel=l.searchLabel),r&&c.setAttribute("aria-disabled","true"),this._(c),c}M(t){this.C=!0,this.H(),this.O(t),this.h(),setTimeout((()=>{this.C=!1}),this.m.cursorTimeout)}A(t){if(!t||!this.I(t))return;this.D=this.D.filter((s=>s!==t));const s=this.l.querySelector(`#${t}`);s&&s.removeAttribute("aria-checked")}S(t){for(const s of t){let t=s.target;if("characterData"===s.type&&(t=s.target.parentElement),!(t instanceof HTMLElement))return;if(t.getAttribute("data-jt-list-box")===this.p){for(const t of s.addedNodes)if(t instanceof HTMLOptGroupElement||t instanceof HTMLOptionElement){const s=h(t,(t=>t instanceof HTMLElement&&t.hasAttribute("data-key")));s instanceof HTMLElement?this.add(t,s.dataset.key):this.add(t,null)}for(const t of s.removedNodes)t instanceof HTMLElement&&t.hasAttribute("data-key")&&this.remove(t.dataset.key)}else if(s.target instanceof HTMLOptionElement||s.target instanceof HTMLOptGroupElement){const e=t.getAttribute("data-key");if(!e)continue;const i=this.l.querySelector(`#${e}`);if(!i)continue;const h=this.F(s.target,!1),n=s.target instanceof HTMLOptGroupElement?this.L(h,!0):this.k(h,!0);this.l.replaceChild(n,i),n.id=e}}}F(t,s=!0){var e;const i=t.disabled,h=t.dataset.key?t.dataset.key:o(this.p);if(s&&this.N&&(t.dataset.key=h,this.N.observe(t,{attributes:!0,characterData:"OPTION"===t.nodeName,childList:"OPTGROUP"===t.nodeName,subtree:!1})),t instanceof HTMLOptGroupElement){return{key:h,label:t.dataset.label?t.dataset.label:t.label.trim(),group:Array.from(t.querySelectorAll("option")).map((t=>this.F(t,s))).filter((t=>null!==t)),disabled:i,data:t.dataset}}if("separator"===t.dataset.role){return{key:h,disabled:i,separator:!0,data:(({key:t,label:s,role:e,...i})=>i)(t.dataset)}}{const s=t.value,r=t.dataset.label?t.dataset.label:t.label?t.label:(null===(e=t.textContent)||void 0===e?void 0:e.trim())||"",o=(({key:t,label:s,role:e,...i})=>i||{})(t.dataset);return{key:h,label:r||s,value:s||r,disabled:i,selected:n(t,"selected"),data:o}}}P(t){return"option"===t.getAttribute("role")&&!n(t,"aria-disabled")}I(t){return-1!==this.D.indexOf(t)}G(t){const s=this.l.querySelector(`#${t}`);if(s instanceof HTMLElement)return s.dataset.label}U(t){const s=t.target;if(s&&s instanceof HTMLElement&&this.P(s)){const e=new CustomEvent("item:click",{bubbles:!0,detail:{mouseEvent:t,value:s.dataset.value}});this.l.dispatchEvent(e)}}J(t){const s=t.target;s&&s instanceof HTMLElement&&this.P(s)&&!this.C&&(this.O(),this.H(s.id))}R(t){const s=t.target;s&&s instanceof HTMLElement&&s.matches(".jt-hover")&&!this.C&&(this.O(),this.H())}q(t){var s;const e={key:t.id||"",value:t.dataset.value,label:t.dataset.label,groupLabel:t.dataset.groupLabel,searchRegex:this.B||void 0,searchString:this.K||void 0,type:this.m.type||"single",data:{}};try{e.data=JSON.parse(t.dataset.itemData||"{}")}catch(t){}const i=null===(s=t.getAttribute("role"))||void 0===s?void 0:s.toLowerCase();return"option"===i?(e.disabled=n(t,"aria-disabled"),e.focused=this.o===t.id):"separator"===i?e.separator=!0:"true"===t.dataset.empty&&(e.creating=this.m.canCreate,e.empty=!0),e}_(t){var s;let e;const i=this.q(t),h=null===(s=t.getAttribute("role"))||void 0===s?void 0:s.toLowerCase();"option"===h||"separator"===h||"true"===t.dataset.empty?e=this.V||a:"presentation"===h&&(e=this.W||l),e?t.innerHTML=e(i):t.textContent=i.label||""}X(t){if(t&&!this.I(t))if("multiple"===this.m.type){const s=this.l.querySelector(`#${t}`);s instanceof HTMLElement&&(this.D.push(t),s.setAttribute("aria-checked","true"))}else if("single"===this.m.type)if(this.l.querySelectorAll("[role=option]").forEach((t=>{t.removeAttribute("aria-checked"),t.removeAttribute("aria-selected")})),null===t)this.D=[];else{const s=this.l.querySelector(`#${t}`);s&&(this.D=[t],s.setAttribute("aria-selected","true"))}}O(t){const s=this.l.querySelector(".jt-focused"),e=t?this.l.querySelector(`#${t}`):null;t&&s&&s.id===t||(s&&(s.dispatchEvent(new FocusEvent("item:focusout",{bubbles:!0,relatedTarget:e})),s.classList.remove("jt-focused"),this.o="",this._(s)),e instanceof HTMLElement&&this.P(e)&&(e.classList.add("jt-focused"),e.dispatchEvent(new FocusEvent("item:focusin",{bubbles:!0,relatedTarget:s})),this.o=t,this._(e)))}H(t){const s=this.l.querySelector(".jt-hover"),e=t?this.l.querySelector(`#${t}`):null;t&&s&&s.id===t||(s&&(s.classList.remove("jt-hover"),this.Y="",this._(s)),e instanceof HTMLElement&&this.P(e)&&(e.classList.add("jt-hover"),this.Y=t,this._(e)))}$(){let t=!1;this.l.querySelectorAll("[role=option]").forEach((s=>{if(!(s instanceof HTMLElement))return;const e=s.dataset.searchLabel?s.dataset.searchLabel:s.dataset.label;e&&this.K&&null===e.match(this.B)?(s.setAttribute("aria-hidden","true"),s.setAttribute("hidden","true")):(s.removeAttribute("aria-hidden"),s.removeAttribute("hidden"),t=!0),this._(s)}));const s=t=>"option"===t.getAttribute("role")&&!n(t,"hidden")&&!n(t,"aria-hidden");this.l.querySelectorAll("[role=separator]").forEach((function(t){h(t,s)&&function(t,s){let e=t.previousElementSibling;for(;e;){if(s(e))return e;e=e.previousElementSibling}return e}(t,s)?(t.removeAttribute("aria-hidden"),t.removeAttribute("hidden")):(t.setAttribute("aria-hidden","true"),t.setAttribute("hidden","true"))})),this.l.querySelectorAll("[role=presentation]").forEach((t=>{if(!(t instanceof HTMLElement))return;const e=t.closest(".jt-listbox__group");e&&(h(t,s)?(e.removeAttribute("aria-hidden"),e.removeAttribute("hidden")):(e.setAttribute("aria-hidden","true"),e.setAttribute("hidden","true")),this._(t))}));const e=this.l.querySelector(`#${this.p}-empty`);e instanceof HTMLElement&&(t?(e.setAttribute("aria-hidden","true"),e.setAttribute("hidden","true")):(e.removeAttribute("aria-hidden"),e.removeAttribute("hidden")),this._(e))}Z(t,s,...e){"list"===t?this.l.classList[s](...e):"group"===t?this.l.querySelectorAll('[role="group"]').forEach((t=>t.classList[s](...e))):"header"===t?this.l.querySelectorAll('[role="group"] [role="presentation"]').forEach((t=>t.classList[s](...e))):"item"===t&&this.l.querySelectorAll(".jt-listbox__item").forEach((t=>t.classList[s](...e)))}tt(t){const s=this.l.querySelector(`#${t}`);if(s instanceof HTMLElement)return s.dataset.value}st(){return this.l?Array.from(this.l.querySelectorAll("[role=option]")).filter((t=>!n(t,"aria-hidden")&&!n(t,"aria-disabled"))).filter((t=>!this.m.hideSelected||!this.I(t.id))).map((t=>t.id)):[]}add(t,s){let e,i=null;if("number"==typeof s){const t=Array.from(this.l.querySelectorAll("[role=option]"));s>0&&s<t.length&&(i=t[s])}else"string"==typeof s&&(i=this.l.querySelector(`#${s}`));const h=t instanceof HTMLElement?this.F(t):"object"==typeof t?t:{label:t};return h?(e=h.group?this.L(h):this.k(h),e?(i?i.insertAdjacentElement("beforebegin",e):this.l.append(e),h.selected&&("multiple"!==this.m.type&&""!==this.value&&console.warn(`Multiple selected options provided to ${this.p}`),this.X(e.id)),e):null):null}clear(){this.D=[],this.l.querySelectorAll("[role=option]").forEach((t=>{t.removeAttribute("aria-checked"),t.removeAttribute("aria-selected")}))}deselect(t){this.l.querySelectorAll(`[data-value="${t}"]`).forEach((t=>this.A(t.id)))}disconnect(){this.N&&this.N.disconnect();const t=document.querySelector(`[data-jt-list-box="${this.p}"]`);t&&t.removeAttribute("data-jt-list-box"),document.querySelectorAll(`option[data-key^="${this.p}"]`).forEach((t=>t.removeAttribute("data-key")))}focusClear(){this.H(),this.O()}focusDown(){const t=this.st(),s=t.indexOf(this.o||this.Y);s<t.length-1&&this.M(t[s+1])}focusEnd(){const t=this.st();t.length>0&&this.M(t[t.length-1])}focusHome(){const t=this.st();t.length>0&&this.M(t[0])}focusPageDown(){const t=this.st(),s=t.indexOf(this.o||this.Y);if(t.length>0){const e=Math.min(s+(this.m.pageSize||10),t.length-1);this.M(t[e])}}focusPageUp(){const t=this.st(),s=-1===t.indexOf(this.o||this.Y)?t.length:t.indexOf(this.o||this.Y);if(t.length>0){const e=Math.max(s-(this.m.pageSize||10),0);this.M(t[e])}}focusSelected(){0===this.D.length?this.focusHome():this.M(this.D[0])}focusTypeahead(t){if(!t)return;const s=t.toLowerCase(),e=this.st().map((t=>{var s;return[t,null===(s=this.G(t))||void 0===s?void 0:s.toLowerCase()]})).filter((t=>"string"==typeof t[1]&&t[1].startsWith(s)));if(!e.length)return void this.O();const i=e.findIndex((([t,s])=>t===this.o));i>=e.length-1?this.M(e[0][0]):this.M(e[i+1][0])}focusUp(){const t=this.st(),s=t.indexOf(this.o||this.Y);-1===s?this.M(t[t.length-1]):s>0&&this.M(t[s-1])}focusValue(t){const s=this.l.querySelector(`[data-value="${t}"]`);return!!(s&&s instanceof HTMLElement&&this.P(s))&&(this.M(s.id),!0)}item(t){let s=null;if("number"==typeof t){const e=Array.from(this.l.querySelectorAll("[role=option]"));t>0&&t<e.length&&(s=e[t])}else"string"==typeof t&&(s=this.l.querySelector(`#${t}`));return s instanceof HTMLLIElement?this.q(s):null}itemByValue(t){const s=document.querySelector(`[data-value="${t}"]`);return s instanceof HTMLLIElement?this.q(s):null}remove(t){let s=null;if("number"==typeof t){const e=Array.from(this.l.querySelectorAll("[role=option]"));t>0&&t<e.length&&(s=e[t])}else"string"==typeof t&&(s=this.l.querySelector(`#${t}`));s&&this.l.removeChild(s)}select(t){this.l.querySelectorAll(`[data-value="${t}"]`).forEach((t=>this.X(t.id)))}toggle(t){this.l.querySelectorAll(`[data-value="${t}"]`).forEach((t=>this.I(t.id)?this.A(t.id):this.X(t.id)))}get displayText(){const t=this.D.map((t=>this.G(t))).filter((t=>!!t));return"multiple"===this.m.type?t:"single"===this.m.type&&t.length?t[0]:""}get empty(){return 0===this.st().length}get filter(){return this.K}set filter(t){this.K=t,this.K?this.m.filterRegex?this.B=this.m.filterRegex(t):this.B=new RegExp(`\\b(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"i"):this.B=null,this.$()}get focusedId(){return this.o||this.Y}get focusedValue(){if(!this.o||this.Y)return"";const t=this.l.querySelector(`#${this.o||this.Y}`);return t&&t.dataset.value?t.dataset.value:""}get groupClassList(){return this.T}get headerClassList(){return this.j}get headerTemplate(){return this.W}set headerTemplate(t){this.W=t,this.$()}get listClassList(){return this.g}get itemClassList(){return this.v}get itemTemplate(){return this.V}set itemTemplate(t){this.V=t,this.$()}get root(){return this.l}get value(){const t=this.D.map((t=>this.tt(t))).filter((t=>!!t));return"multiple"===this.m.type?t:"single"===this.m.type&&t.length?t[0]:""}set value(t){if(this.clear(),"multiple"===this.m.type)Array.isArray(t)?t.forEach((t=>{this.select(t)})):this.select(t);else if("single"===this.m.type){if(Array.isArray(t))throw new Error("Cannot select multiple items");this.select(t)}}constructor(t,s,e){this.et=!1,this.C=!1,this.K="",this.o="",this.Y="",this.p="",this.B=null,this.D=[],this.p=t,this.m=Object.assign({},c,e||{}),this.T=new r(((t,...s)=>this.Z("group",t,...s)),this.m.groupListClasses||[]),this.j=new r(((t,...s)=>this.Z("header",t,...s)),this.m.groupHeaderClasses||[]),this.v=new r(((t,...s)=>this.Z("item",t,...s)),this.m.itemClasses||[]),this.g=new r(((t,...s)=>this.Z("list",t,...s)),this.m.listClasses||[]),this.W=this.m.groupHeaderTemplate||null,this.V=this.m.itemTemplate||null,this.N=new MutationObserver((t=>this.S(t))),s instanceof HTMLElement&&(s.dataset.jtListBox=this.p,this.N.observe(s,{childList:!0})),this.l=this.u(s),this.l.addEventListener("click",(t=>this.U(t)),{capture:!0}),this.l.addEventListener("pointerenter",(t=>this.J(t)),{capture:!0}),this.l.addEventListener("pointerleave",(t=>this.R(t)),{capture:!0})}}function d(t,s){const e=Object.keys(s),i=Object.values(s);return new Function(...e,`return \`${t}\`;`)(...i)}class p extends HTMLElement{get disabled(){return n(this,"disabled")}set disabled(t){t?(this.setAttribute("aria-disabled","true"),this.setAttribute("disabled",""),this.it.setAttribute("aria-disabled","true"),this.X.setAttribute("disabled","")):(this.removeAttribute("aria-disabled"),this.removeAttribute("disabled"),this.it.removeAttribute("aria-disabled"),this.X.removeAttribute("disabled")),this.ht&&(this.ht.disabled=t)}get groupClass(){return this.getAttribute("groupclass")}set groupClass(t){this.setAttribute("groupclass",t)}get groupClassList(){return this.nt.groupClassList}get headerClass(){return this.getAttribute("headerclass")}set headerClass(t){this.setAttribute("headerclass",t)}get headerClassList(){return this.nt.headerClassList}get headerTemplate(){return this.W}set headerTemplate(t){"function"==typeof t?(this.setAttribute("headertemplate","function"),this.W=t,this.nt.headerTemplate=t):"string"==typeof t?this.setAttribute("headertemplate",t):t||this.removeAttribute("headertemplate")}get itemClass(){return this.getAttribute("itemclass")}set itemClass(t){this.setAttribute("itemclass",t)}get itemClassList(){return this.nt.itemClassList}get itemTemplate(){return this.V}set itemTemplate(t){"function"==typeof t?(this.setAttribute("itemtemplate","function"),this.V=t,this.nt.itemTemplate=t):"string"==typeof t?this.setAttribute("itemtemplate",t):t||this.removeAttribute("itemtemplate")}get listClass(){return this.getAttribute("listclass")}set listClass(t){this.setAttribute("listclass",t)}get listClassList(){return this.nt.listClassList}get open(){return n(this.it,"aria-expanded")}set open(t){t&&!this.disabled?this.rt():this.ot()}get readOnly(){return n(this,"readonly")}set readOnly(t){t?(this.setAttribute("aria-readonly","true"),this.setAttribute("readonly","")):(this.removeAttribute("aria-readonly"),this.removeAttribute("readonly"))}get searchable(){return n(this,"searchable")}set searchable(t){t?this.setAttribute("searchable",""):this.removeAttribute("searchable")}get value(){return this.nt.value}lt(){this.ct||(this.hasAttribute("src")?fetch(this.getAttribute("src")).then((t=>t.json())).then((t=>this.ut(t))).catch((t=>{throw new Error(t)})):this.ut(this.X))}ot(){this.it.setAttribute("aria-expanded","false"),this.nt&&this.nt.focusClear(),this.classList.remove("jt-open"),this.searchable&&(this.it.tabIndex=this.dt,this.ft.tabIndex=-1,this.ft.value="",this.nt.filter="")}bt(t){for(const s of t)if("attributes"===s.type&&s.target===this.X){if("disabled"===s.attributeName)this.disabled=this.X.disabled}else"data-key"!==s.attributeName&&(this.hasAttribute("src")||(this.ot(),this.ct=!1))}gt(){this.vt=!1,this.yt=!1,this.it.parentElement.classList.remove("jt-focus"),this.nt.root.classList.remove("jt-focus")}_t(){this.vt=!1,this.yt=!0,this.it.parentElement.classList.add("jt-focus"),this.nt.root.classList.remove("jt-focus")}$t(){this.vt=!0,this.yt=!1,this.it.parentElement.classList.remove("jt-focus"),this.nt.root.classList.add("jt-focus")}wt(){return{groupListClasses:this.groupClass?[...this.groupClass.split(" ")]:[],groupHeaderClasses:this.headerClass?[...this.headerClass.split(" ")]:[],itemClasses:this.itemClass?[...this.itemClass.split(" ")]:[],listClasses:this.listClass?[...this.listClass.split(" ")]:[],groupHeaderTemplate:this.W,itemTemplate:this.V,type:"single"}}Et(t){if(!t)return null;if(t.includes("${"))return s=>d(t,{item:s});try{const s=document.querySelector(`#${t}`);if(s instanceof HTMLElement)return t=>d(s.innerHTML,{item:t})}catch(t){}return null}Lt(){this.open||this.disabled?this.ot():this.rt()}Tt(t){const s=t.target;s instanceof HTMLElement&&null===s.closest(`#${this.p}`)&&this.ot()}jt(t){!t.isComposing&&this.searchable&&(this.nt.filter=t.target.value)}xt(){this._t()}kt(){this.gt()}Mt(t){this.readOnly||this.Ct(t.detail.value),this.ot()}Ht(t){this.it.setAttribute("aria-activedescendant",t.target instanceof HTMLElement&&t.target.id||"")}Ot(t){t.relatedTarget instanceof HTMLElement?this.it.setAttribute("aria-activedescendant",t.relatedTarget.id||""):this.it.setAttribute("aria-activedescendant","")}At(t){const{key:s,altKey:e,ctrlKey:i,metaKey:h,isComposing:n}=t;if(n)return;if(!this.open&&["ArrowDown","ArrowUp","Down","Enter"," ","Up"].includes(s))return this.rt(),t.stopPropagation(),void t.preventDefault();switch("Backspace"!==s&&"Clear"!==s&&(1!==s.length||" "===s||e||i||h)||(this.searchable?this.open||this.rt(!1):1===s.length&&(this.open||this.rt(!1),this.It(s))),s){case"ArrowDown":case"Down":return this.nt.focusDown(),t.stopPropagation(),void t.preventDefault();case"ArrowUp":case"Up":return e?(this.Dt(),this.ot()):this.nt.focusUp(),t.stopPropagation(),void t.preventDefault();case"End":return this.nt.focusEnd(),t.stopPropagation(),void t.preventDefault();case"Enter":case" ":if(" "===s&&this.searchable)return;return this.Dt(),this.ot(),t.stopPropagation(),void t.preventDefault();case"Escape":return this.ot(),t.stopPropagation(),void t.preventDefault();case"Home":return this.nt.focusHome(),t.stopPropagation(),void t.preventDefault()}}rt(t=!1){this.disabled||(this.lt(),this.it.setAttribute("aria-expanded","true"),this.classList.add("jt-open"),t&&this.nt&&this.nt.focusSelected(),this.searchable&&document.activeElement!==this.ft&&(this.it.tabIndex=-1,this.ft.tabIndex=this.dt||0,this.ft.focus()))}Dt(){this.nt.focusedValue&&this.Ct(this.nt.focusedValue)}Ct(t){this.disabled||this.readOnly||(this.nt.value=t,this.St(),this.ot(),this.dispatchEvent(new CustomEvent("change",{detail:this.value})))}ut(t){const s=new u(`${this.p}-listbox`,t,this.wt());this.nt.root.replaceWith(s.root),this.nt=s,this.ct=!0,this.nt.root.addEventListener("item:click",(t=>this.Mt(t))),this.nt.root.addEventListener("item:focusin",(t=>this.Ht(t))),this.nt.root.addEventListener("item:focusout",(t=>this.Ot(t))),this.Ft()}Nt(){if(!this.isConnected)return;if(this.X=this.querySelector("select"),!this.X)return;this.dt=this.X.tabIndex,this.it=document.createElement("div"),this.it.setAttribute("id",`${this.p}-control`),this.it.setAttribute("role","combobox"),this.it.setAttribute("data-role","control"),this.it.setAttribute("aria-controls",`${this.p}-listbox`),this.it.setAttribute("aria-expanded","false"),this.it.setAttribute("aria-haspopup","listbox"),this.it.setAttribute("tabindex",`${this.dt}`),this.it.addEventListener("click",(()=>this.Lt())),this.it.addEventListener("focusin",(()=>this.xt())),this.it.addEventListener("focusout",(()=>this.kt())),this.addEventListener("keydown",(t=>this.At(t)),{capture:!0}),this.Pt=i(`<button type='button' data-action='close' id="${this.p}-close" tabindex="-1"><span class='jt-sr-only'>Close Suggestion List</span></button>`),this.Pt.addEventListener("click",(()=>this.ot())),this.ht=i(`<button type='button' data-action='clear' id='${this.p}-clear' tabindex="-1"><span class='jt-sr-only'>Clear Input</span></button>`),this.ht.addEventListener("click",(()=>this.clear()));const t=document.createElement("div");t.classList.add("jt-control__buttons"),t.appendChild(this.ht);const s=document.createElement("div");s.classList.add("jt-control"),s.appendChild(this.it),s.appendChild(t),this.appendChild(s),this.ft=i(`<input id="${this.p}-filter" type="search" tabindex="-1" placeholder="Search Options" />`),this.ft.addEventListener("input",(t=>this.jt(t)));const e=document.createElement("div");e.classList.add("jt-select__search"),e.appendChild(this.Pt),e.appendChild(this.ft),this.ct=!1,this.nt=new u(`${this.p}-listbox`,[],this.wt()),this.nt.groupClassList.value=this.getAttribute("groupClass"),this.nt.headerClassList.value=this.getAttribute("headerClass"),this.nt.itemClassList.value=this.getAttribute("itemClass"),this.nt.listClassList.value=this.getAttribute("listClass");const h=document.createElement("div");if(h.classList.add("jt-popup"),h.appendChild(e),h.appendChild(this.nt.root),this.appendChild(h),this.open=!1,this.disabled=this.X.disabled,this.classList.toggle("jt-placeholder-shown",""==this.X.value),this.X.addEventListener("change",(()=>{this.classList.toggle("jt-placeholder-shown",""==this.X.value)})),this.X instanceof HTMLElement&&(document.activeElement===this.X&&this.it.focus(),this.X.style.display="none",this.X.id)){const t=document.querySelector(`[for="${this.X.id}"]`);t instanceof HTMLLabelElement&&(t.htmlFor=`${this.p}-control`,t.id||(t.id=`${this.p}-label`),this.it.setAttribute("aria-labelledby",t.id))}this.N=new MutationObserver((t=>this.bt(t))),this.N.observe(this.X,{attributes:!0,childList:!0,subtree:!0}),document.addEventListener("click",(t=>this.Tt(t))),this.lt(),this.St(),this.Ft()}Gt(){const t=Array.from(this.X.selectedOptions).map((t=>t.value));(""===this.value&&0!==t.length||""!==this.value&&t.length>0||this.value!==t[0])&&(this.nt.value?Array.isArray(this.nt.value)?(this.X.querySelectorAll("option").forEach((t=>{t.selected=t.value&&this.nt.value.includes(t.value)})),this.X.dispatchEvent(new Event("change"))):this.nt.value!==t[0]&&(this.X.value=this.nt.value,this.X.dispatchEvent(new Event("change"))):(this.X.value="",this.X.dispatchEvent(new Event("change"))))}It(t){var s;"number"==typeof this.Ut&&window.clearTimeout(this.Ut),this.Ut=window.setTimeout((()=>{this.K=""}),this.Jt||500),this.K+=t,this.K.length>1&&(s=this.K.split("")).every((t=>t===s[0]))?this.nt.focusTypeahead(this.K[0]):this.nt.focusTypeahead(this.K)}St(){this.nt.value?(this.it.innerHTML=`<span>${this.nt.displayText}</span>`,this.classList.remove("jt-placeholder-shown")):(this.it.innerHTML=`<span class="jt-placeholder">${this.getAttribute("placeholder")||"&nbsp;"}</span>`,this.classList.add("jt-placeholder-shown")),this.Gt()}Ft(){const t=this.nt.root.scrollWidth;0==t?setTimeout((()=>this.Ft()),100):this.it.style.width=`${t}px`}clear(){this.Ct("")}constructor(){super(),this.K="",this.Jt=500,this.p=this.getAttribute("id")||s("jt-select"),this.hasAttribute("id")||this.setAttribute("id",this.p)}static get observedAttributes(){return["groupclass","headerclass","headertemplate","itemclass","itemtemplate","listclass","src"]}attributeChangedCallback(t,s,e){switch(t){case"groupclass":this.nt.groupClassList.value=e;break;case"headerclass":this.nt.headerClassList.value=e;break;case"itemclass":this.nt.itemClassList.value=e;break;case"listclass":this.nt.listClassList.value=e;break;case"headertemplate":null===e?(this.W=null,this.nt.headerTemplate=null):"function"!==e&&(this.W=this.Et(e),this.nt.headerTemplate=this.W);break;case"itemtemplate":null===e?(this.V=null,this.nt.itemTemplate=null):"function"!==e&&(this.V=this.Et(e),this.nt.itemTemplate=this.V);break;case"src":this.ot(),this.ct=!1}}connectedCallback(){setTimeout((()=>this.Nt()),0)}static register(){customElements.define("jt-select",p)}}return p.register(),p}();

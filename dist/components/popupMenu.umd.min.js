/*! JtControls v0.2.2 | (c) 2023 Jonathan Krauss | BSD-3-Clause License | git+https://github.com/asymworks/jadetree-ui.git */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).JtControls=e()}(this,(function(){"use strict";function t(t){return t.split("-")[1]}function e(t){return"y"===t?"height":"width"}function n(t){return t.split("-")[0]}function o(t){return["top","bottom"].includes(n(t))?"x":"y"}function i(i,r,s){let{reference:a,floating:c}=i;const l=a.x+a.width/2-c.width/2,u=a.y+a.height/2-c.height/2,f=o(r),d=e(f),h=a[d]/2-c[d]/2,p="x"===f;let m;switch(n(r)){case"top":m={x:l,y:a.y-c.height};break;case"bottom":m={x:l,y:a.y+a.height};break;case"right":m={x:a.x+a.width,y:u};break;case"left":m={x:a.x-c.width,y:u};break;default:m={x:a.x,y:a.y}}switch(t(r)){case"start":m[f]-=h*(s&&p?-1:1);break;case"end":m[f]+=h*(s&&p?-1:1)}return m}function r(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}async function s(t,e){var n;void 0===e&&(e={});const{x:o,y:i,platform:s,rects:a,elements:c,strategy:l}=t,{boundary:u="clippingAncestors",rootBoundary:f="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=e,m=function(t){return"number"!=typeof t?function(t){return{top:0,right:0,bottom:0,left:0,...t}}(t):{top:t,right:t,bottom:t,left:t}}(p),y=c[h?"floating"===d?"reference":"floating":d],g=r(await s.getClippingRect({element:null==(n=await(null==s.isElement?void 0:s.isElement(y)))||n?y:y.contextElement||await(null==s.getDocumentElement?void 0:s.getDocumentElement(c.floating)),boundary:u,rootBoundary:f,strategy:l})),x="floating"===d?{...a.floating,x:o,y:i}:a.reference,w=await(null==s.getOffsetParent?void 0:s.getOffsetParent(c.floating)),b=await(null==s.isElement?void 0:s.isElement(w))&&await(null==s.getScale?void 0:s.getScale(w))||{x:1,y:1},v=r(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({rect:x,offsetParent:w,strategy:l}):x);return{top:(g.top-v.top+m.top)/b.y,bottom:(v.bottom-g.bottom+m.bottom)/b.y,left:(g.left-v.left+m.left)/b.x,right:(v.right-g.right+m.right)/b.x}}const a=Math.min,c=Math.max;function l(t,e,n){return c(t,a(e,n))}const u={left:"right",right:"left",bottom:"top",top:"bottom"};function f(t){return t.replace(/left|right|bottom|top/g,(t=>u[t]))}const d={start:"end",end:"start"};function h(t){return t.replace(/start|end/g,(t=>d[t]))}const p=function(i){return void 0===i&&(i={}),{name:"flip",options:i,async fn(r){var a;const{placement:c,middlewareData:l,rects:u,initialPlacement:d,platform:p,elements:m}=r,{mainAxis:y=!0,crossAxis:g=!0,fallbackPlacements:x,fallbackStrategy:w="bestFit",fallbackAxisSideDirection:b="none",flipAlignment:v=!0,...A}=i,k=n(c),T=n(d)===d,R=await(null==p.isRTL?void 0:p.isRTL(m.floating)),M=x||(T||!v?[f(d)]:function(t){const e=f(t);return[h(t),e,h(e)]}(d));x||"none"===b||M.push(...function(e,o,i,r){const s=t(e);let a=function(t,e,n){const o=["left","right"],i=["right","left"],r=["top","bottom"],s=["bottom","top"];switch(t){case"top":case"bottom":return n?e?i:o:e?o:i;case"left":case"right":return e?r:s;default:return[]}}(n(e),"start"===i,r);return s&&(a=a.map((t=>t+"-"+s)),o&&(a=a.concat(a.map(h)))),a}(d,v,b,R));const S=[d,...M],E=await s(r,A),F=[];let _=(null==(a=l.flip)?void 0:a.overflows)||[];if(y&&F.push(E[k]),g){const{main:n,cross:i}=function(n,i,r){void 0===r&&(r=!1);const s=t(n),a=o(n),c=e(a);let l="x"===a?s===(r?"end":"start")?"right":"left":"start"===s?"bottom":"top";return i.reference[c]>i.floating[c]&&(l=f(l)),{main:l,cross:f(l)}}(c,u,R);F.push(E[n],E[i])}if(_=[..._,{placement:c,overflows:F}],!F.every((t=>t<=0))){var j,C;const t=((null==(j=l.flip)?void 0:j.index)||0)+1,e=S[t];if(e)return{data:{index:t,overflows:_},reset:{placement:e}};let n=null==(C=_.filter((t=>t.overflows[0]<=0)).sort(((t,e)=>t.overflows[1]-e.overflows[1]))[0])?void 0:C.placement;if(!n)switch(w){case"bestFit":{var L;const t=null==(L=_.map((t=>[t.placement,t.overflows.filter((t=>t>0)).reduce(((t,e)=>t+e),0)])).sort(((t,e)=>t[1]-e[1]))[0])?void 0:L[0];t&&(n=t);break}case"initialPlacement":n=d}if(c!==n)return{reset:{placement:n}}}return{}}}};const m=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(i){const{x:r,y:s}=i,a=await async function(e,i){const{placement:r,platform:s,elements:a}=e,c=await(null==s.isRTL?void 0:s.isRTL(a.floating)),l=n(r),u=t(r),f="x"===o(r),d=["left","top"].includes(l)?-1:1,h=c&&f?-1:1,p="function"==typeof i?i(e):i;let{mainAxis:m,crossAxis:y,alignmentAxis:g}="number"==typeof p?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...p};return u&&"number"==typeof g&&(y="end"===u?-1*g:g),f?{x:y*h,y:m*d}:{x:m*d,y:y*h}}(i,e);return{x:r+a.x,y:s+a.y,data:a}}}};function y(t){var e;return(null==(e=t.ownerDocument)?void 0:e.defaultView)||window}function g(t){return y(t).getComputedStyle(t)}function x(t){return t instanceof y(t).Node}function w(t){return x(t)?(t.nodeName||"").toLowerCase():""}function b(t){return t instanceof y(t).HTMLElement}function v(t){return t instanceof y(t).Element}function A(t){if("undefined"==typeof ShadowRoot)return!1;return t instanceof y(t).ShadowRoot||t instanceof ShadowRoot}function k(t){const{overflow:e,overflowX:n,overflowY:o,display:i}=g(t);return/auto|scroll|overlay|hidden|clip/.test(e+o+n)&&!["inline","contents"].includes(i)}function T(t){return["table","td","th"].includes(w(t))}function R(t){const e=M(),n=g(t);return"none"!==n.transform||"none"!==n.perspective||!e&&!!n.backdropFilter&&"none"!==n.backdropFilter||!e&&!!n.filter&&"none"!==n.filter||["transform","perspective","filter"].some((t=>(n.willChange||"").includes(t)))||["paint","layout","strict","content"].some((t=>(n.contain||"").includes(t)))}function M(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function S(t){return["html","body","#document"].includes(w(t))}const E=Math.min,F=Math.max,_=Math.round;function j(t){const e=g(t);let n=parseFloat(e.width)||0,o=parseFloat(e.height)||0;const i=b(t),r=i?t.offsetWidth:n,s=i?t.offsetHeight:o,a=_(n)!==r||_(o)!==s;return a&&(n=r,o=s),{width:n,height:o,fallback:a}}function C(t){return v(t)?t:t.contextElement}const L={x:1,y:1};function P(t){const e=C(t);if(!b(e))return L;const n=e.getBoundingClientRect(),{width:o,height:i,fallback:r}=j(e);let s=(r?_(n.width):n.width)/o,a=(r?_(n.height):n.height)/i;return s&&Number.isFinite(s)||(s=1),a&&Number.isFinite(a)||(a=1),{x:s,y:a}}const $={x:0,y:0};function O(t,e,n){var o,i;if(void 0===e&&(e=!0),!M())return $;const r=t?y(t):window;return!n||e&&n!==r?$:{x:(null==(o=r.visualViewport)?void 0:o.offsetLeft)||0,y:(null==(i=r.visualViewport)?void 0:i.offsetTop)||0}}function D(t,e,n,o){void 0===e&&(e=!1),void 0===n&&(n=!1);const i=t.getBoundingClientRect(),s=C(t);let a=L;e&&(o?v(o)&&(a=P(o)):a=P(t));const c=O(s,n,o);let l=(i.left+c.x)/a.x,u=(i.top+c.y)/a.y,f=i.width/a.x,d=i.height/a.y;if(s){const t=y(s),e=o&&v(o)?y(o):o;let n=t.frameElement;for(;n&&o&&e!==t;){const t=P(n),e=n.getBoundingClientRect(),o=getComputedStyle(n);e.x+=(n.clientLeft+parseFloat(o.paddingLeft))*t.x,e.y+=(n.clientTop+parseFloat(o.paddingTop))*t.y,l*=t.x,u*=t.y,f*=t.x,d*=t.y,l+=e.x,u+=e.y,n=y(n).frameElement}}return r({width:f,height:d,x:l,y:u})}function q(t){return((x(t)?t.ownerDocument:t.document)||window.document).documentElement}function z(t){return v(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function B(t){return D(q(t)).left+z(t).scrollLeft}function H(t){if("html"===w(t))return t;const e=t.assignedSlot||t.parentNode||A(t)&&t.host||q(t);return A(e)?e.host:e}function I(t){const e=H(t);return S(e)?e.ownerDocument.body:b(e)&&k(e)?e:I(e)}function N(t,e){var n;void 0===e&&(e=[]);const o=I(t),i=o===(null==(n=t.ownerDocument)?void 0:n.body),r=y(o);return i?e.concat(r,r.visualViewport||[],k(o)?o:[]):e.concat(o,N(o))}function V(t,e,n){let o;if("viewport"===e)o=function(t,e){const n=y(t),o=q(t),i=n.visualViewport;let r=o.clientWidth,s=o.clientHeight,a=0,c=0;if(i){r=i.width,s=i.height;const t=M();(!t||t&&"fixed"===e)&&(a=i.offsetLeft,c=i.offsetTop)}return{width:r,height:s,x:a,y:c}}(t,n);else if("document"===e)o=function(t){const e=q(t),n=z(t),o=t.ownerDocument.body,i=F(e.scrollWidth,e.clientWidth,o.scrollWidth,o.clientWidth),r=F(e.scrollHeight,e.clientHeight,o.scrollHeight,o.clientHeight);let s=-n.scrollLeft+B(t);const a=-n.scrollTop;return"rtl"===g(o).direction&&(s+=F(e.clientWidth,o.clientWidth)-i),{width:i,height:r,x:s,y:a}}(q(t));else if(v(e))o=function(t,e){const n=D(t,!0,"fixed"===e),o=n.top+t.clientTop,i=n.left+t.clientLeft,r=b(t)?P(t):{x:1,y:1};return{width:t.clientWidth*r.x,height:t.clientHeight*r.y,x:i*r.x,y:o*r.y}}(e,n);else{const n=O(t);o={...e,x:e.x-n.x,y:e.y-n.y}}return r(o)}function G(t,e){const n=H(t);return!(n===e||!v(n)||S(n))&&("fixed"===g(n).position||G(n,e))}function U(t,e){return b(t)&&"fixed"!==g(t).position?e?e(t):t.offsetParent:null}function W(t,e){const n=y(t);if(!b(t))return n;let o=U(t,e);for(;o&&T(o)&&"static"===g(o).position;)o=U(o,e);return o&&("html"===w(o)||"body"===w(o)&&"static"===g(o).position&&!R(o))?n:o||function(t){let e=H(t);for(;b(e)&&!S(e);){if(R(e))return e;e=H(e)}return null}(t)||n}function X(t,e,n){const o=b(e),i=q(e),r="fixed"===n,s=D(t,!0,r,e);let a={scrollLeft:0,scrollTop:0};const c={x:0,y:0};if(o||!o&&!r)if(("body"!==w(e)||k(i))&&(a=z(e)),b(e)){const t=D(e,!0,r,e);c.x=t.x+e.clientLeft,c.y=t.y+e.clientTop}else i&&(c.x=B(i));return{x:s.left+a.scrollLeft-c.x,y:s.top+a.scrollTop-c.y,width:s.width,height:s.height}}const Y={getClippingRect:function(t){let{element:e,boundary:n,rootBoundary:o,strategy:i}=t;const r=[..."clippingAncestors"===n?function(t,e){const n=e.get(t);if(n)return n;let o=N(t).filter((t=>v(t)&&"body"!==w(t))),i=null;const r="fixed"===g(t).position;let s=r?H(t):t;for(;v(s)&&!S(s);){const e=g(s),n=R(s);n||"fixed"!==e.position||(i=null),(r?!n&&!i:!n&&"static"===e.position&&i&&["absolute","fixed"].includes(i.position)||k(s)&&!n&&G(t,s))?o=o.filter((t=>t!==s)):i=e,s=H(s)}return e.set(t,o),o}(e,this.t):[].concat(n),o],s=r[0],a=r.reduce(((t,n)=>{const o=V(e,n,i);return t.top=F(o.top,t.top),t.right=E(o.right,t.right),t.bottom=E(o.bottom,t.bottom),t.left=F(o.left,t.left),t}),V(e,s,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},convertOffsetParentRelativeRectToViewportRelativeRect:function(t){let{rect:e,offsetParent:n,strategy:o}=t;const i=b(n),r=q(n);if(n===r)return e;let s={scrollLeft:0,scrollTop:0},a={x:1,y:1};const c={x:0,y:0};if((i||!i&&"fixed"!==o)&&(("body"!==w(n)||k(r))&&(s=z(n)),b(n))){const t=D(n);a=P(n),c.x=t.x+n.clientLeft,c.y=t.y+n.clientTop}return{width:e.width*a.x,height:e.height*a.y,x:e.x*a.x-s.scrollLeft*a.x+c.x,y:e.y*a.y-s.scrollTop*a.y+c.y}},isElement:v,getDimensions:function(t){return j(t)},getOffsetParent:W,getDocumentElement:q,getScale:P,async getElementRects(t){let{reference:e,floating:n,strategy:o}=t;const i=this.getOffsetParent||W,r=this.getDimensions;return{reference:X(e,await i(n),o),floating:{x:0,y:0,...await r(n)}}},getClientRects:t=>Array.from(t.getClientRects()),isRTL:t=>"rtl"===g(t).direction};const J=(t,e,n)=>{const o=new Map,r={platform:Y,...n},s={...r.platform,t:o};return(async(t,e,n)=>{const{placement:o="bottom",strategy:r="absolute",middleware:s=[],platform:a}=n,c=s.filter(Boolean),l=await(null==a.isRTL?void 0:a.isRTL(e));let u=await a.getElementRects({reference:t,floating:e,strategy:r}),{x:f,y:d}=i(u,o,l),h=o,p={},m=0;for(let n=0;n<c.length;n++){const{name:s,fn:y}=c[n],{x:g,y:x,data:w,reset:b}=await y({x:f,y:d,initialPlacement:o,placement:h,strategy:r,middlewareData:p,rects:u,platform:a,elements:{reference:t,floating:e}});f=null!=g?g:f,d=null!=x?x:d,p={...p,[s]:{...p[s],...w}},b&&m<=50&&(m++,"object"==typeof b&&(b.placement&&(h=b.placement),b.rects&&(u=!0===b.rects?await a.getElementRects({reference:t,floating:e,strategy:r}):b.rects),({x:f,y:d}=i(u,h,l))),n=-1)}return{x:f,y:d,placement:h,strategy:r,middlewareData:p}})(t,e,{...r,platform:s})},K=new Map,Q="rtl"===window.getComputedStyle(document.documentElement).direction,Z={LEFT:37,UP:38,RIGHT:39,DOWN:40},tt=t=>{const{currentTarget:e}=t;K.get("last_rover")!=e&&K.has(e)&&(rt(e,K.get(e).active),K.set("last_rover",e))},et=t=>{const{currentTarget:e}=t;switch(t.keyCode){case Z[Q?"LEFT":"RIGHT"]:case Z.DOWN:t.preventDefault(),ot(e);break;case Z[Q?"RIGHT":"LEFT"]:case Z.UP:t.preventDefault(),it(e)}},nt=new MutationObserver(((t,e)=>{t.filter((t=>t.removedNodes.length>0)).forEach((t=>{[...t.removedNodes].filter((t=>1===t.nodeType)).forEach((t=>{K.forEach(((e,n)=>{"last_rover"!==n&&t.contains(n)&&(n.removeEventListener("focusin",tt),n.removeEventListener("keydown",et),K.delete(n),e.targets.forEach((t=>t.tabIndex="")),(0===K.size||1===K.size&&K.has("last_rover"))&&(K.clear(),nt.disconnect()))}))}))}))})),ot=t=>{const e=K.get(t);e.index+=1,e.index>e.targets.length-1&&(e.index=e.targets.length-1);let n=e.targets[e.index];n&&rt(t,n)},it=t=>{const e=K.get(t);e.index-=1,e.index<1&&(e.index=0);let n=e.targets[e.index];n&&rt(t,n)},rt=(t,e)=>{const n=K.get(t);n.active.tabIndex=-1,n.active=e,n.active.tabIndex=0,n.active.focus()};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var st={};!function(t,e){t.exports=function(){var t={length:32,template:"%qinu%",dict:"1234567890abcdefghijklmnopqrstuvwxyz",random:!1},e=function(t,n){if(!t.length)return"";var o=n.indexOf(t.slice(-1));return o+1<n.length?t.slice(0,-1)+n[o+1]:e(t.slice(0,-1),n)+n[0]},n=function(t,e,o){if(void 0===o&&(o=""),o.length>=e)return o;var i=t[Math.floor(Math.random()*t.length)];return n(t,e,o+i)},o=function(t,e,n){return n.reduce((function(t,e,n){return t.replace(new RegExp("%arg\\["+n+"\\]%","g"),e)}),t.replace(/%qinu%/g,e))},i=function(e){return e||0===e?"object"!=typeof e&&(e={length:+e}):e={},(e=Object.assign({},t,e)).dict&&(e.dict=e.dict.split("").sort().filter((function(t,e,n){return n[e-1]!==t})).join("")),e},r=function(){};function s(t,e){var s=this instanceof r?t:i(t),a=s.dict,c=s.length,l=s.template,u=s.args,f=s.random;e instanceof Array||(e=Array.prototype.slice.call(arguments,1)),u instanceof Array&&(e=u.concat(e));var d=!f&&this instanceof r?this.next(a,c):n(a,c);return o(l,d,e)}return r.prototype.next=function(t,o){var i=this.key||n(t,o);return this.key=e(i,t),this.key},s.create=function(t){return s.bind(new r,i(t))},s}()}({get exports(){return st},set exports(t){st=t}});var at=st.create({length:6,template:"%arg[0]%-%qinu%"});class ct extends HTMLElement{o(t){t.currentTarget instanceof Element&&t.currentTarget.closest(`#${this.i}`)&&(this.open(),this.l())}u(t){t.currentTarget instanceof Element&&t.currentTarget.closest(`#${this.i}`)&&this.close()}l(){const t=this.getAttribute("alignment")||"center",e=this.getAttribute("placement")||"right";this.h=this.getAttribute("offset")?parseInt(this.getAttribute("offset")):null,this.p=`${e}${"center"!==t?"-"+t:""}`,this.m=this.getAttribute("selector")||"button",this.g&&this.v&&function(t,e,n,o){void 0===o&&(o={});const{ancestorScroll:i=!0,ancestorResize:r=!0,elementResize:s=!0,animationFrame:a=!1}=o,c=i||r?[...v(t)?N(t):t.contextElement?N(t.contextElement):[],...N(e)]:[];c.forEach((t=>{const e=!v(t)&&t.toString().includes("V");!i||a&&!e||t.addEventListener("scroll",n,{passive:!0}),r&&t.addEventListener("resize",n)}));let l,u=null;s&&(u=new ResizeObserver((()=>{n()})),v(t)&&!a&&u.observe(t),v(t)||!t.contextElement||a||u.observe(t.contextElement),u.observe(e));let f=a?D(t):null;a&&function e(){const o=D(t);!f||o.x===f.x&&o.y===f.y&&o.width===f.width&&o.height===f.height||n(),f=o,l=requestAnimationFrame(e)}(),n()}(this.g,this.v,(()=>{var t;J(this.g,this.v,{placement:this.p,middleware:[p(),(void 0===t&&(t={}),{name:"shift",options:t,async fn(e){const{x:i,y:r,placement:a}=e,{mainAxis:c=!0,crossAxis:u=!1,limiter:f={fn:t=>{let{x:e,y:n}=t;return{x:e,y:n}}},...d}=t,h={x:i,y:r},p=await s(e,d),m=o(n(a)),y="x"===m?"y":"x";let g=h[m],x=h[y];if(c){const t="y"===m?"bottom":"right";g=l(g+p["y"===m?"top":"left"],g,g-p[t])}if(u){const t="y"===y?"bottom":"right";x=l(x+p["y"===y?"top":"left"],x,x-p[t])}const w=f.fn({...e,[m]:g,[y]:x});return{...w,data:{x:w.x-i,y:w.y-r}}}}),this.h&&m(this.h)]}).then((({x:t,y:e})=>{Object.assign(this.v.style,{left:`${t}px`,top:`${e}px`})}))}))}A(){if(!this.isConnected)return;this.hasAttribute("id")||this.setAttribute("id",this.i),this.g=this.querySelector("[slot=trigger]"),this.v=this.querySelector("[slot=target]"),this.v.classList.add("jt-popup__popup"),this.v.hasAttribute("id")||this.v.setAttribute("id",`${this.i}-menu`);const t=document.createElement("div");t.classList.add("jt-popup"),t.setAttribute("aria-haspopup","true"),t.setAttribute("aria-controls",this.v.getAttribute("id")),t.setAttribute("aria-expanded","false"),t.appendChild(this.g),t.appendChild(this.v),this.appendChild(t),(({element:t,target:e})=>{const n=t.querySelectorAll(e||":scope *"),o=n[0];t.tabIndex=-1,n.forEach((t=>t.tabIndex=-1)),o.tabIndex=0,K.set(t,{targets:n,active:o,index:0}),t.addEventListener("focusin",tt),t.addEventListener("keydown",et),nt.observe(document,{childList:!0,subtree:!0})})({element:t,target:`[slot=target] ${this.m}`}),t.addEventListener("focusin",(t=>this.o(t))),t.addEventListener("focusout",(t=>this.u(t))),t.addEventListener("keyup",(t=>"Escape"===t.code&&t.target instanceof HTMLElement&&t.target.blur())),this.g.setAttribute("tabindex","-1"),this.g.addEventListener("click",(()=>{const t=this.querySelector(`[slot=target] ${this.m}`);t instanceof HTMLElement&&t.focus()}))}close(){this.querySelector("div").setAttribute("aria-expanded","false")}open(){this.querySelector("div").setAttribute("aria-expanded","true")}constructor(){super(),this.i=this.getAttribute("id")||at("jt-popup-menu")}static get observedAttributes(){return["alignment","placement","offset"]}attributeChangedCallback(t){switch(t){case"alignment":case"placement":case"offset":this.l()}}connectedCallback(){setTimeout((()=>this.A()),0)}static register(){customElements.define("jt-popup-menu",ct)}}return ct.register(),ct}));

/*! JtControls v0.2.1 | (c) 2023 Jonathan Krauss | BSD-3-Clause License | git+https://github.com/asymworks/jadetree-ui.git */
!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).JtControls=s()}(this,(function(){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t={};!function(t,s){t.exports=function(){var t={length:32,template:"%qinu%",dict:"1234567890abcdefghijklmnopqrstuvwxyz",random:!1},s=function(t,e){if(!t.length)return"";var i=e.indexOf(t.slice(-1));return i+1<e.length?t.slice(0,-1)+e[i+1]:s(t.slice(0,-1),e)+e[0]},e=function(t,s,i){if(void 0===i&&(i=""),i.length>=s)return i;var h=t[Math.floor(Math.random()*t.length)];return e(t,s,i+h)},i=function(t,s,e){return e.reduce((function(t,s,e){return t.replace(new RegExp("%arg\\["+e+"\\]%","g"),s)}),t.replace(/%qinu%/g,s))},h=function(s){return s||0===s?"object"!=typeof s&&(s={length:+s}):s={},(s=Object.assign({},t,s)).dict&&(s.dict=s.dict.split("").sort().filter((function(t,s,e){return e[s-1]!==t})).join("")),s},n=function(){};function o(t,s){var o=this instanceof n?t:h(t),r=o.dict,a=o.length,l=o.template,c=o.args,u=o.random;s instanceof Array||(s=Array.prototype.slice.call(arguments,1)),c instanceof Array&&(s=c.concat(s));var d=!u&&this instanceof n?this.next(r,a):e(r,a);return i(l,d,s)}return n.prototype.next=function(t,i){var h=this.key||e(t,i);return this.key=s(h,t),this.key},o.create=function(t){return o.bind(new n,h(t))},o}()}({get exports(){return t},set exports(s){t=s}});const s=t.create({length:6,template:"%arg[0]%-%qinu%"}),e=function(){if(!window.DOMParser)return!1;try{(new DOMParser).parseFromString("x","text/html")}catch(t){return!1}return!0}();function i(t){if(e){const s=(new DOMParser).parseFromString(t,"text/html");return s.body.firstElementChild instanceof Element?s.body.firstElementChild:s.body}const s=document.createElement("div");return s.innerHTML=t,s.firstElementChild instanceof Element?s.firstElementChild:s}function h(t,s){let e=t.nextElementSibling;for(;e;){if(s(e))return e;e=e.nextElementSibling}return e}function n(t,s,e){var i;return!(!t||!t.hasAttribute(s))&&(!(null==e?void 0:e.aria)&&!s.toLowerCase().startsWith("aria-")||"true"===(null===(i=t.getAttribute(s))||void 0===i?void 0:i.toLowerCase()))}class o{[Symbol.iterator](){return this.values()}get length(){return this.t.length}get value(){return this.t.join(" ")}set value(t){if(t){const s=(t||"").split(" ").map((t=>t.trim())),e=s.filter((t=>!this.t.includes(t))),i=this.t.filter((t=>!s.includes(t)));e.length>0&&this.i("add",...e),i.length>0&&this.i("remove",...i)}else this.t.length>0&&this.i("remove",...this.t),this.t=[]}add(...t){const s=t.filter((t=>!this.t.includes(t)));s.length>0&&(this.t.push(...s),this.i("add",...s))}contains(t){return this.t.includes(t)}entries(){return this.t.entries()}forEach(t,s){const e=t.bind(s);for(const[t,s]of this.entries())e(s,t,this)}item(t){return t<0||t>=this.length?null:this.t.at(t)}keys(){return this.t.keys()}remove(...t){const s=t.filter((t=>this.t.includes(t)));s.length>0&&(this.t=this.t.filter((t=>!s.includes(t))),this.i("remove",...s))}replace(t,s){const e=this.t.indexOf(t);if(-1===e)return!1;this.t[e]=s,this.i("remove",t),this.i("add",s)}supports(t){return!0}toggle(t,s){return this.contains(t)||void 0!==s&&!s?!this.contains(t)||void 0!==s&&s||this.remove(t):this.add(t),this.contains(t)}values(){return this.t.values()}constructor(t,s){this.i=t,this.t=s||[]}}const r=t=>s(`${t}-item`),a=t=>t.searchRegex&&t.label&&!t.empty?t.label.replace(t.searchRegex,"<mark>$&</mark>"):t.creating?`Press enter to create <mark>${t.searchString}</mark>`:t.empty?t.searchString||t.label?"No Items Found":"No Items":t.label||"",l=t=>t.label||"",c={canSelect:!0,cursorTimeout:150,filterRegex:t=>new RegExp(`\\b(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"i"),pageSize:10,type:"single"};class u{h(){if(!this.o)return;const t=this.l.querySelector(`#${this.o}`);t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}u(t){const s=`<ul class="jt-listbox" role="listbox" id="${this.p}" data-type="${this.m.type}"></ul>`;if(this.l=i(s),this.l.classList.add(...this.g.values()),"number"==typeof this.m.tabIndex&&this.l.setAttribute("tabindex",`${this.m.tabIndex}`),t instanceof HTMLElement)for(const s of t.children)if(s instanceof HTMLOptionElement||s instanceof HTMLOptGroupElement){if("placeholder"===s.dataset.role)continue;this.add(s)}else 3!==s.nodeType&&console.warn(`Unexpected element ${s.nodeName.toLowerCase()} in <${t.nodeName.toLowerCase()}>`);else Array.isArray(t)?t.forEach((t=>this.add(t))):console.error(`Unexpected type "${typeof t}" provided to _createDom`,t);const e=i(`<li class="jt-listbox__item" id="${this.p}-empty" data-empty="true" aria-hidden="true" hidden="true"></li>`);return e.classList.add(...this.v.values()),this.m.canCreate?e.setAttribute("role","option"):e.setAttribute("role","presentation"),this._(e),this.l.append(e),this.$(),this.l}T(t,s=!1){const e=t.key?t.key:r(this.p);document.querySelector(`#${e}`)&&!s&&console.error(`An element with key ${e} already exists.`);const{label:h,group:n,disabled:o,data:a}=t;h||console.warn("Label for <optgroup> is empty");const l=i(`\n<li class="jt-listbox__group" id="${e}">\n    <ul role="group" aria-labelledby="${e}-hdr">\n        <li role="presentation" class="jt-listbox__item jt-listbox__item--header" data-label="${h}" id="${e}-hdr"></li>\n    </ul>\n</li>`);l.classList.add(...this.L.values()),Object.keys(a||{}).length&&(l.dataset.itemData=JSON.stringify(a)),o&&l.setAttribute("aria-disabled","true");const c=l.querySelector('ul[role="group"]');if(!c)throw new Error("_createGroup did not render a ul[role=group]");const u=l.querySelector("li[role=presentation]");if(u.classList.add(...this.k.values()),!u)throw new Error("_createGroup did not render a li[role=presentation]");return u.dataset.groupId=e,u.dataset.itemData=JSON.stringify(a),this._(u),null==n||n.forEach((t=>{t.group?console.error("Nested option groups are not allowed"):c.append(this.j(t))})),l}j(t,s=!1){const e=t.key?t.key:r(this.p);document.querySelector(`#${e}`)&&!s&&console.error(`An element with key ${e} already exists.`);const{label:h,value:n,disabled:o,separator:a,data:l}=t;if(a){const t=i(`<li class="jt-listbox__item" id="${e}" role="separator"></li>`);return t.classList.add(...this.v.values()),t.dataset.itemData=JSON.stringify(l),this._(t),t}h||n||console.warn("Neither label nor value was specified for <option>"),this.l.querySelector(`[data-value="${n||h}"]`)&&!s&&console.warn(`An element with value ${n||h} already exists.`);const c=i(`<li class="jt-listbox__item" id="${e}" data-value="${n||h}" data-label="${h||n}" role="option"></li>`);return c.classList.add(...this.v.values()),Object.keys(l||{}).length&&(c.dataset.itemData=JSON.stringify(l)),l&&l.searchLabel&&(c.dataset.searchLabel=l.searchLabel),o&&c.setAttribute("aria-disabled","true"),this._(c),c}M(t){this.C=!0,this.H(),this.O(t),this.h(),setTimeout((()=>{this.C=!1}),this.m.cursorTimeout)}A(t){if(!t||!this.I(t))return;this.S=this.S.filter((s=>s!==t));const s=this.l.querySelector(`#${t}`);s&&s.removeAttribute("aria-checked")}D(t){for(const s of t){let t=s.target;if("characterData"===s.type&&(t=s.target.parentElement),!(t instanceof HTMLElement))return;if(t.getAttribute("data-jt-list-box")===this.p){for(const t of s.addedNodes)if(t instanceof HTMLOptGroupElement||t instanceof HTMLOptionElement){const s=h(t,(t=>t instanceof HTMLElement&&t.hasAttribute("data-key")));s instanceof HTMLElement?this.add(t,s.dataset.key):this.add(t,null)}for(const t of s.removedNodes)t instanceof HTMLElement&&t.hasAttribute("data-key")&&this.remove(t.dataset.key)}else if(s.target instanceof HTMLOptionElement||s.target instanceof HTMLOptGroupElement){const e=t.getAttribute("data-key");if(!e)continue;const i=this.l.querySelector(`#${e}`);if(!i)continue;const h=this.F(s.target,!1),n=s.target instanceof HTMLOptGroupElement?this.T(h,!0):this.j(h,!0);this.l.replaceChild(n,i),n.id=e}}}F(t,s=!0){var e;const i=t.disabled,h=t.dataset.key?t.dataset.key:r(this.p);if(s&&this.N&&(t.dataset.key=h,this.N.observe(t,{attributes:!0,characterData:"OPTION"===t.nodeName,childList:"OPTGROUP"===t.nodeName,subtree:!1})),t instanceof HTMLOptGroupElement){return{key:h,label:t.dataset.label?t.dataset.label:t.label.trim(),group:Array.from(t.querySelectorAll("option")).map((t=>this.F(t,s))).filter((t=>null!==t)),disabled:i,data:t.dataset}}if("separator"===t.dataset.role){return{key:h,disabled:i,separator:!0,data:(({key:t,label:s,role:e,...i})=>i)(t.dataset)}}{const s=t.value,o=t.dataset.label?t.dataset.label:t.label?t.label:(null===(e=t.textContent)||void 0===e?void 0:e.trim())||"",r=(({key:t,label:s,role:e,...i})=>i||{})(t.dataset);return{key:h,label:o||s,value:s||o,disabled:i,selected:n(t,"selected"),data:r}}}P(t){return"option"===t.getAttribute("role")&&!n(t,"aria-disabled")}I(t){return-1!==this.S.indexOf(t)}G(t){const s=this.l.querySelector(`#${t}`);if(s instanceof HTMLElement)return s.dataset.label}R(t){const s=t.target;if(s&&s instanceof HTMLElement&&this.P(s)){const e=new CustomEvent("item:click",{bubbles:!0,detail:{mouseEvent:t,value:s.dataset.value}});this.l.dispatchEvent(e)}}U(t){const s=t.target;s&&s instanceof HTMLElement&&this.P(s)&&!this.C&&(this.O(),this.H(s.id))}J(t){const s=t.target;s&&s instanceof HTMLElement&&s.matches(".jt-hover")&&!this.C&&(this.O(),this.H())}q(t){var s;const e={key:t.id||"",value:t.dataset.value,label:t.dataset.label,groupLabel:t.dataset.groupLabel,searchRegex:this.B||void 0,searchString:this.V||void 0,type:this.m.type||"single",data:{}};try{e.data=JSON.parse(t.dataset.itemData||"{}")}catch(t){}const i=null===(s=t.getAttribute("role"))||void 0===s?void 0:s.toLowerCase();return"option"===i?(e.disabled=n(t,"aria-disabled"),e.focused=this.o===t.id):"separator"===i?e.separator=!0:"true"===t.dataset.empty&&(e.creating=this.m.canCreate,e.empty=!0),e}_(t){var s;let e;const i=this.q(t),h=null===(s=t.getAttribute("role"))||void 0===s?void 0:s.toLowerCase();"option"===h||"separator"===h||"true"===t.dataset.empty?e=this.K||a:"presentation"===h&&(e=this.W||l),e?t.innerHTML=e(i):t.textContent=i.label||""}X(t){if(t&&!this.I(t))if("multiple"===this.m.type){const s=this.l.querySelector(`#${t}`);s instanceof HTMLElement&&(this.S.push(t),s.setAttribute("aria-checked","true"))}else if("single"===this.m.type)if(this.l.querySelectorAll("[role=option]").forEach((t=>{t.removeAttribute("aria-checked"),t.removeAttribute("aria-selected")})),null===t)this.S=[];else{const s=this.l.querySelector(`#${t}`);s&&(this.S=[t],s.setAttribute("aria-selected","true"))}}O(t){const s=this.l.querySelector(".jt-focused"),e=t?this.l.querySelector(`#${t}`):null;t&&s&&s.id===t||(s&&(s.dispatchEvent(new FocusEvent("item:focusout",{bubbles:!0,relatedTarget:e})),s.classList.remove("jt-focused"),this.o="",this._(s)),e instanceof HTMLElement&&this.P(e)&&(e.classList.add("jt-focused"),e.dispatchEvent(new FocusEvent("item:focusin",{bubbles:!0,relatedTarget:s})),this.o=t,this._(e)))}H(t){const s=this.l.querySelector(".jt-hover"),e=t?this.l.querySelector(`#${t}`):null;t&&s&&s.id===t||(s&&(s.classList.remove("jt-hover"),this.Y="",this._(s)),e instanceof HTMLElement&&this.P(e)&&(e.classList.add("jt-hover"),this.Y=t,this._(e)))}$(){let t=!1;this.l.querySelectorAll("[role=option]").forEach((s=>{if(!(s instanceof HTMLElement))return;const e=s.dataset.searchLabel?s.dataset.searchLabel:s.dataset.label;e&&this.V&&null===e.match(this.B)?(s.setAttribute("aria-hidden","true"),s.setAttribute("hidden","true")):(s.removeAttribute("aria-hidden"),s.removeAttribute("hidden"),t=!0),this._(s)}));const s=t=>"option"===t.getAttribute("role")&&!n(t,"hidden")&&!n(t,"aria-hidden");this.l.querySelectorAll("[role=separator]").forEach((function(t){h(t,s)&&function(t,s){let e=t.previousElementSibling;for(;e;){if(s(e))return e;e=e.previousElementSibling}return e}(t,s)?(t.removeAttribute("aria-hidden"),t.removeAttribute("hidden")):(t.setAttribute("aria-hidden","true"),t.setAttribute("hidden","true"))})),this.l.querySelectorAll("[role=presentation]").forEach((t=>{if(!(t instanceof HTMLElement))return;const e=t.closest(".jt-listbox__group");e&&(h(t,s)?(e.removeAttribute("aria-hidden"),e.removeAttribute("hidden")):(e.setAttribute("aria-hidden","true"),e.setAttribute("hidden","true")),this._(t))}));const e=this.l.querySelector(`#${this.p}-empty`);e instanceof HTMLElement&&(t?(e.setAttribute("aria-hidden","true"),e.setAttribute("hidden","true")):(e.removeAttribute("aria-hidden"),e.removeAttribute("hidden")),this._(e))}Z(t,s,...e){"list"===t?this.l.classList[s](...e):"group"===t?this.l.querySelectorAll('[role="group"]').forEach((t=>t.classList[s](...e))):"header"===t?this.l.querySelectorAll('[role="group"] [role="presentation"]').forEach((t=>t.classList[s](...e))):"item"===t&&this.l.querySelectorAll(".jt-listbox__item").forEach((t=>t.classList[s](...e)))}tt(t){const s=this.l.querySelector(`#${t}`);if(s instanceof HTMLElement)return s.dataset.value}st(){return this.l?Array.from(this.l.querySelectorAll("[role=option]")).filter((t=>!n(t,"aria-hidden")&&!n(t,"aria-disabled"))).filter((t=>!this.m.hideSelected||!this.I(t.id))).map((t=>t.id)):[]}add(t,s){let e,i=null;if("number"==typeof s){const t=Array.from(this.l.querySelectorAll("[role=option]"));s>0&&s<t.length&&(i=t[s])}else"string"==typeof s&&(i=this.l.querySelector(`#${s}`));const h=t instanceof HTMLElement?this.F(t):"object"==typeof t?t:{label:t};return h?(e=h.group?this.T(h):this.j(h),e?(i?i.insertAdjacentElement("beforebegin",e):this.l.append(e),h.selected&&("multiple"!==this.m.type&&""!==this.value&&console.warn(`Multiple selected options provided to ${this.p}`),this.X(e.id)),e):null):null}clear(){this.S=[],this.l.querySelectorAll("[role=option]").forEach((t=>{t.removeAttribute("aria-checked"),t.removeAttribute("aria-selected")}))}deselect(t){this.l.querySelectorAll(`[data-value="${t}"]`).forEach((t=>this.A(t.id)))}disconnect(){this.N&&this.N.disconnect();const t=document.querySelector(`[data-jt-list-box="${this.p}"]`);t&&t.removeAttribute("data-jt-list-box"),document.querySelectorAll(`option[data-key^="${this.p}"]`).forEach((t=>t.removeAttribute("data-key")))}focusClear(){this.H(),this.O()}focusDown(){const t=this.st(),s=t.indexOf(this.o||this.Y);s<t.length-1&&this.M(t[s+1])}focusEnd(){const t=this.st();t.length>0&&this.M(t[t.length-1])}focusHome(){const t=this.st();t.length>0&&this.M(t[0])}focusPageDown(){const t=this.st(),s=t.indexOf(this.o||this.Y);if(t.length>0){const e=Math.min(s+(this.m.pageSize||10),t.length-1);this.M(t[e])}}focusPageUp(){const t=this.st(),s=-1===t.indexOf(this.o||this.Y)?t.length:t.indexOf(this.o||this.Y);if(t.length>0){const e=Math.max(s-(this.m.pageSize||10),0);this.M(t[e])}}focusSelected(){0===this.S.length?this.focusHome():this.M(this.S[0])}focusTypeahead(t){if(!t)return;const s=t.toLowerCase(),e=this.st().map((t=>{var s;return[t,null===(s=this.G(t))||void 0===s?void 0:s.toLowerCase()]})).filter((t=>"string"==typeof t[1]&&t[1].startsWith(s)));if(!e.length)return void this.O();const i=e.findIndex((([t,s])=>t===this.o));i>=e.length-1?this.M(e[0][0]):this.M(e[i+1][0])}focusUp(){const t=this.st(),s=t.indexOf(this.o||this.Y);-1===s?this.M(t[t.length-1]):s>0&&this.M(t[s-1])}focusValue(t){const s=this.l.querySelector(`[data-value="${t}"]`);return!!(s&&s instanceof HTMLElement&&this.P(s))&&(this.M(s.id),!0)}item(t){let s=null;if("number"==typeof t){const e=Array.from(this.l.querySelectorAll("[role=option]"));t>0&&t<e.length&&(s=e[t])}else"string"==typeof t&&(s=this.l.querySelector(`#${t}`));return s instanceof HTMLLIElement?this.q(s):null}itemByValue(t){const s=document.querySelector(`[data-value="${t}"]`);return s instanceof HTMLLIElement?this.q(s):null}remove(t){let s=null;if("number"==typeof t){const e=Array.from(this.l.querySelectorAll("[role=option]"));t>0&&t<e.length&&(s=e[t])}else"string"==typeof t&&(s=this.l.querySelector(`#${t}`));s&&this.l.removeChild(s)}select(t){this.l.querySelectorAll(`[data-value="${t}"]`).forEach((t=>this.X(t.id)))}toggle(t){this.l.querySelectorAll(`[data-value="${t}"]`).forEach((t=>this.I(t.id)?this.A(t.id):this.X(t.id)))}get displayText(){const t=this.S.map((t=>this.G(t))).filter((t=>!!t));return"multiple"===this.m.type?t:"single"===this.m.type&&t.length?t[0]:""}get empty(){return 0===this.st().length}get filter(){return this.V}set filter(t){this.V=t,this.V?this.m.filterRegex?this.B=this.m.filterRegex(t):this.B=new RegExp(`\\b(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"i"):this.B=null,this.$()}get focusedId(){return this.o||this.Y}get focusedValue(){if(!this.o||this.Y)return"";const t=this.l.querySelector(`#${this.o||this.Y}`);return t&&t.dataset.value?t.dataset.value:""}get groupClassList(){return this.L}get headerClassList(){return this.k}get headerTemplate(){return this.W}set headerTemplate(t){this.W=t,this.$()}get listClassList(){return this.g}get itemClassList(){return this.v}get itemTemplate(){return this.K}set itemTemplate(t){this.K=t,this.$()}get root(){return this.l}get value(){const t=this.S.map((t=>this.tt(t))).filter((t=>!!t));return"multiple"===this.m.type?t:"single"===this.m.type&&t.length?t[0]:""}set value(t){if(this.clear(),"multiple"===this.m.type)Array.isArray(t)?t.forEach((t=>{this.select(t)})):this.select(t);else if("single"===this.m.type){if(Array.isArray(t))throw new Error("Cannot select multiple items");this.select(t)}}constructor(t,s,e){this.et=!1,this.C=!1,this.V="",this.o="",this.Y="",this.p="",this.B=null,this.S=[],this.p=t,this.m=Object.assign({},c,e||{}),this.L=new o(((t,...s)=>this.Z("group",t,...s)),this.m.groupListClasses||[]),this.k=new o(((t,...s)=>this.Z("header",t,...s)),this.m.groupHeaderClasses||[]),this.v=new o(((t,...s)=>this.Z("item",t,...s)),this.m.itemClasses||[]),this.g=new o(((t,...s)=>this.Z("list",t,...s)),this.m.listClasses||[]),this.W=this.m.groupHeaderTemplate||null,this.K=this.m.itemTemplate||null,this.N=new MutationObserver((t=>this.D(t))),s instanceof HTMLElement&&(s.dataset.jtListBox=this.p,this.N.observe(s,{childList:!0})),this.l=this.u(s),this.l.addEventListener("click",(t=>this.R(t)),{capture:!0}),this.l.addEventListener("pointerenter",(t=>this.U(t)),{capture:!0}),this.l.addEventListener("pointerleave",(t=>this.J(t)),{capture:!0})}}function d(t,s){const e=Object.keys(s),i=Object.values(s);return new Function(...e,`return \`${t}\`;`)(...i)}const p=["text","search","url","tel","email"];class f extends HTMLElement{get disabled(){var t;return!!(null===(t=this.it)||void 0===t?void 0:t.disabled)}set disabled(t){t?(this.setAttribute("aria-disabled","true"),this.setAttribute("disabled","")):(this.removeAttribute("aria-disabled"),this.removeAttribute("disabled")),this.ht.disabled=t,this.nt&&(this.nt.disabled=t),this.it.disabled!=t&&(this.it.disabled=t)}get groupClass(){return this.getAttribute("groupclass")}set groupClass(t){this.setAttribute("groupclass",t)}get groupClassList(){return this.ot.groupClassList}get headerClass(){return this.getAttribute("headerclass")}set headerClass(t){this.setAttribute("headerclass",t)}get headerClassList(){return this.ot.headerClassList}get headerTemplate(){return this.W}set headerTemplate(t){"function"==typeof t?(this.setAttribute("headertemplate","function"),this.W=t,this.ot.headerTemplate=t):"string"==typeof t?this.setAttribute("headertemplate",t):t||this.removeAttribute("headertemplate")}get itemClass(){return this.getAttribute("itemclass")}set itemClass(t){this.setAttribute("itemclass",t)}get itemClassList(){return this.ot.itemClassList}get itemTemplate(){return this.K}set itemTemplate(t){"function"==typeof t?(this.setAttribute("itemtemplate","function"),this.K=t,this.ot.itemTemplate=t):"string"==typeof t?this.setAttribute("itemtemplate",t):t||this.removeAttribute("itemtemplate")}get listClass(){return this.getAttribute("listclass")}set listClass(t){this.setAttribute("listclass",t)}get listClassList(){return this.ot.listClassList}get open(){return n(this.it,"aria-expanded")}set open(t){t&&!this.disabled?this.rt():this.lt()}get readOnly(){return this.it.readOnly}set readOnly(t){t?(this.setAttribute("aria-readonly","true"),this.setAttribute("readonly","")):(this.removeAttribute("aria-readonly"),this.removeAttribute("readonly")),this.it.readOnly!=t&&(this.it.readOnly=t)}ct(){if(!this.ut&&this.dt)if("#"==this.dt[0]){const t=document.querySelector(this.dt);t instanceof HTMLElement&&this.ft(t)}else fetch(this.dt).then((t=>t.json())).then((t=>this.ft(t))).catch((t=>{throw new Error(t)}))}lt(){this.classList.remove("jt-open"),this.it.setAttribute("aria-expanded","false"),this.ht.setAttribute("aria-expanded","false"),this.ot.focusClear(),this.ot.filter=""}bt(t){for(const s of t)switch(s.attributeName){case"disabled":this.disabled=this.it.disabled;break;case"readonly":this.readOnly=this.it.readOnly;break;case"list":if(this.it.hasAttribute("list")&&this.it.getAttribute("list")){this.lt(),this.ut=!1,this.dt=`#${this.it.getAttribute("list")}`,this.it.removeAttribute("list");break}}}gt(){this.yt=!1,this.vt=!1,this.it.parentElement.classList.remove("jt-focus"),this.ot.root.classList.remove("jt-focus")}_t(){this.yt=!0,this.vt=!1,this.it.parentElement.classList.remove("jt-focus"),this.ot.root.classList.add("jt-focus")}$t(){this.yt=!1,this.vt=!0,this.it.parentElement.classList.add("jt-focus"),this.ot.root.classList.remove("jt-focus")}Tt(){return{groupListClasses:this.groupClass?[...this.groupClass.split(" ")]:[],groupHeaderClasses:this.headerClass?[...this.headerClass.split(" ")]:[],itemClasses:this.itemClass?[...this.itemClass.split(" ")]:[],listClasses:this.listClass?[...this.listClass.split(" ")]:[],groupHeaderTemplate:this.W,itemTemplate:this.K,type:"single"}}Et(t){if(!t)return null;if(t.includes("${"))return s=>d(t,{item:s});try{const s=document.querySelector(`#${t}`);if(s instanceof HTMLElement)return t=>d(s.innerHTML,{item:t})}catch(t){}return null}R(){this.disabled||this.readOnly||(this.open=!this.open)}Lt(t){const s=t.target;s instanceof HTMLElement&&null===s.closest(`#${this.p}`)&&this.lt()}kt(){this.$t()}wt(){this.gt()}xt(){this.open||this.rt(),this.ot.focusValue(this.ot.filter),this.ot.filter=this.it.value}jt(t){this.readOnly||this.Mt(t.detail.value),this.lt()}Ct(t){t.target instanceof HTMLElement&&""!==t.target.id?this.it.setAttribute("aria-activedescendant",t.target.id):this.it.removeAttribute("aria-activedescendant")}Ht(t){t.relatedTarget instanceof HTMLElement&&""!==t.relatedTarget.id?this.it.setAttribute("aria-activedescendant",t.relatedTarget.id):this.it.removeAttribute("aria-activedescendant")}Ot(t){let s=!1;const e=this.yt;switch(t.key){case"Enter":this.yt&&this.ot.focusedId?(this.Mt(this.ot.focusedValue),this.lt(),this.$t(),s=!0):this.open&&(this.lt(),this.$t(),s=!0);break;case"Esc":case"Escape":this.open?(this.lt(),this.$t()):this.Mt(""),s=!0;break;case"ArrowDown":case"Down":this.rt(),this._t(),t.altKey||this.ot.focusedId&&!e||this.ot.focusDown(),s=!0;break;case"ArrowUp":case"Up":this.ot.empty||(this.rt(),this._t(),t.altKey||this.ot.focusedId&&!e||this.ot.focusUp()),s=!0;break;case"Tab":""!==this.ot.focusedId&&this.Mt(this.ot.focusedValue),this.lt()}s&&(t.stopPropagation(),t.preventDefault())}At(t){let s=!1;if(1===t.key.length&&t.key.match(/\S| /))this.ot.filter=this.it.value;else if("Escape"===t.key||"Esc"===t.key||"Enter"==t.key)return;switch(t.key){case"Backspace":this.$t(),this.ot.focusClear(),this.ot.filter=this.it.value,s=!0;break;case"Left":case"ArrowLeft":case"Right":case"ArrowRight":case"Home":case"End":this.$t(),this.ot.focusClear(),s=!0;break;default:this.ot.empty||(this.open||this.rt(),this.ot.focusValue(this.ot.filter)),s=!0}s&&(t.stopPropagation(),t.preventDefault())}It(){this.disabled||(this.open=!this.open)}rt(){this.ct(),this.open||(this.classList.add("jt-open"),this.it.setAttribute("aria-expanded","true"),this.ht.setAttribute("aria-expanded","true"),this.readOnly||this.ot.focusValue(this.it.value)||(this.querySelector(".jt-popup").scrollTop=0),document.activeElement!==this.it&&this.it.focus())}ft(t){const s=new u(`${this.p}-listbox`,t,this.Tt());this.ot.root.replaceWith(s.root),this.ot=s,this.ut=!0,this.ot.root.addEventListener("item:click",(t=>this.jt(t))),this.ot.root.addEventListener("item:focusin",(t=>this.Ct(t))),this.ot.root.addEventListener("item:focusout",(t=>this.Ht(t)))}Mt(t){this.readOnly||(this.ot.filter=t,this.it.value=t,this.it.setSelectionRange(t.length,t.length),this.it.dispatchEvent(new Event("input")))}St(){if(!this.isConnected)return;if(this.hasAttribute("id")||this.setAttribute("id",this.p),this.it=this.querySelector("input"),!this.it)return;if(!p.includes(this.it.type||"text"))throw new Error(`JtAutocomplete does not support <input type='${this.it.type}'>`);this.it.hasAttribute("autocomplete")||this.it.setAttribute("autocomplete","off"),this.it.setAttribute("role","combobox"),this.it.setAttribute("aria-autocomplete","list"),this.it.addEventListener("click",(()=>this.R())),this.it.addEventListener("focusin",(()=>this.kt())),this.it.addEventListener("focusout",(()=>this.wt())),this.it.addEventListener("input",(()=>this.xt())),this.it.addEventListener("keydown",(t=>this.Ot(t))),this.it.addEventListener("keyup",(t=>this.At(t))),this.Dt=i(`<button type='button' data-action='close' id="${this.p}-close" tabindex="-1"><span class='jt-sr-only'>Close Suggestion List</span></button>`),this.Dt.addEventListener("click",(()=>this.lt())),this.ht=i(`<button type='button' data-action='open' id='${this.p}-open' tabindex="-1"><span class='jt-sr-only'>Show Suggestions<span></button>`),this.ht.addEventListener("click",(()=>this.It())),this.nt=i(`<button type='button' data-action='clear' id='${this.p}-clear' tabindex="-1"><span class='jt-sr-only'>Clear Input</span></button>`),this.nt.addEventListener("click",(()=>this.clear()));const t=document.createElement("div");t.classList.add("jt-control__buttons"),t.appendChild(this.ht),t.appendChild(this.nt);const s=document.createElement("div");s.classList.add("jt-control"),s.appendChild(this.Dt),s.appendChild(this.it),s.appendChild(t),this.appendChild(s),this.ut=!1,this.hasAttribute("src")?this.dt=this.getAttribute("src"):this.hasAttribute("list")?this.dt=`#${this.getAttribute("list")}`:this.it.hasAttribute("list")&&(this.setAttribute("list",this.it.getAttribute("list")),this.dt=`#${this.it.getAttribute("list")}`,this.it.setAttribute("list",""),this.it.removeAttribute("list")),this.ot=new u(`${this.p}-listbox`,[],this.Tt()),this.ot.groupClassList.value=this.getAttribute("groupClass"),this.ot.headerClassList.value=this.getAttribute("headerClass"),this.ot.itemClassList.value=this.getAttribute("itemClass"),this.ot.listClassList.value=this.getAttribute("listClass");const e=document.createElement("div");e.classList.add("jt-popup"),e.appendChild(this.ot.root),this.appendChild(e),this.open=!1,this.disabled=this.it.disabled,this.readOnly=this.it.readOnly,this.classList.toggle("jt-placeholder-shown",""==this.it.value),this.it.addEventListener("input",(()=>{this.classList.toggle("jt-placeholder-shown",""==this.it.value)})),this.N=new MutationObserver((t=>this.bt(t))),this.N.observe(this.it,{attributes:!0}),document.addEventListener("click",(t=>this.Lt(t)))}clear(){this.Mt(""),requestAnimationFrame((()=>{this.it.focus()}))}matchingItem(){return this.it.value?this.ot.itemByValue(this.it.value):null}constructor(){super(),this.p=this.getAttribute("id")||s("jt-autocomplete")}static get observedAttributes(){return["groupclass","headerclass","headertemplate","itemclass","itemtemplate","listclass","src"]}attributeChangedCallback(t,s,e){switch(t){case"groupclass":this.ot.groupClassList.value=e;break;case"headerclass":this.ot.headerClassList.value=e;break;case"itemclass":this.ot.itemClassList.value=e;break;case"listclass":this.ot.listClassList.value=e;break;case"headertemplate":null===e?(this.W=null,this.ot.headerTemplate=null):"function"!==e&&(this.W=this.Et(e),this.ot.headerTemplate=this.W);break;case"itemtemplate":null===e?(this.K=null,this.ot.itemTemplate=null):"function"!==e&&(this.K=this.Et(e),this.ot.itemTemplate=this.K);break;case"src":this.lt(),this.ut=!1,this.dt=e}}connectedCallback(){setTimeout((()=>this.St()),0)}static register(){customElements.define("jt-autocomplete",f)}}return f.register(),f}));

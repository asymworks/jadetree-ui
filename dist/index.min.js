/*! JtControls v0.2.0 | (c) 2023 Jonathan Krauss | BSD-3-Clause License | git+https://github.com/asymworks/jadetree-ui.git */
"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t={};({get exports(){return t},set exports(s){t=s}}).exports=function(){var t={length:32,template:"%qinu%",dict:"1234567890abcdefghijklmnopqrstuvwxyz",random:!1},s=function(t,e){if(!t.length)return"";var i=e.indexOf(t.slice(-1));return i+1<e.length?t.slice(0,-1)+e[i+1]:s(t.slice(0,-1),e)+e[0]},e=function(t,s,i){if(void 0===i&&(i=""),i.length>=s)return i;var n=t[Math.floor(Math.random()*t.length)];return e(t,s,i+n)},i=function(t,s,e){return e.reduce((function(t,s,e){return t.replace(new RegExp("%arg\\["+e+"\\]%","g"),s)}),t.replace(/%qinu%/g,s))},n=function(s){return s||0===s?"object"!=typeof s&&(s={length:+s}):s={},(s=Object.assign({},t,s)).dict&&(s.dict=s.dict.split("").sort().filter((function(t,s,e){return e[s-1]!==t})).join("")),s},o=function(){};function h(t,s){var h=this instanceof o?t:n(t),r=h.dict,a=h.length,l=h.template,c=h.args,u=h.random;s instanceof Array||(s=Array.prototype.slice.call(arguments,1)),c instanceof Array&&(s=c.concat(s));var d=!u&&this instanceof o?this.next(r,a):e(r,a);return i(l,d,s)}return o.prototype.next=function(t,i){var n=this.key||e(t,i);return this.key=s(n,t),this.key},h.create=function(t){return h.bind(new o,n(t))},h}();const s=t.create({length:6,template:"%arg[0]%-%qinu%"}),e=function(){if(!window.DOMParser)return!1;try{(new DOMParser).parseFromString("x","text/html")}catch(t){return!1}return!0}();function i(t){if(e){const s=(new DOMParser).parseFromString(t,"text/html");return s.body.firstElementChild instanceof Element?s.body.firstElementChild:s.body}const s=document.createElement("div");return s.innerHTML=t,s.firstElementChild instanceof Element?s.firstElementChild:s}function n(t,s){let e=t.nextElementSibling;for(;e;){if(s(e))return e;e=e.nextElementSibling}return e}function o(t,s,e){var i;return!(!t||!t.hasAttribute(s))&&(!(null==e?void 0:e.aria)&&!s.toLowerCase().startsWith("aria-")||"true"===(null===(i=t.getAttribute(s))||void 0===i?void 0:i.toLowerCase()))}class h{[Symbol.iterator](){return this.values()}get length(){return this.t.length}get value(){return this.t.join(" ")}set value(t){if(t){const s=(t||"").split(" ").map((t=>t.trim())),e=s.filter((t=>!this.t.includes(t))),i=this.t.filter((t=>!s.includes(t)));e.length>0&&this.i("add",...e),i.length>0&&this.i("remove",...i)}else this.t.length>0&&this.i("remove",...this.t),this.t=[]}add(...t){const s=t.filter((t=>!this.t.includes(t)));s.length>0&&(this.t.push(...s),this.i("add",...s))}contains(t){return this.t.includes(t)}entries(){return this.t.entries()}forEach(t,s){const e=t.bind(s);for(const[t,s]of this.entries())e(s,t,this)}item(t){return t<0||t>=this.length?null:this.t.at(t)}keys(){return this.t.keys()}remove(...t){const s=t.filter((t=>this.t.includes(t)));s.length>0&&(this.t=this.t.filter((t=>!s.includes(t))),this.i("remove",...s))}replace(t,s){const e=this.t.indexOf(t);if(-1===e)return!1;this.t[e]=s,this.i("remove",t),this.i("add",s)}supports(t){return!0}toggle(t,s){return this.contains(t)||void 0!==s&&!s?!this.contains(t)||void 0!==s&&s||this.remove(t):this.add(t),this.contains(t)}values(){return this.t.values()}constructor(t,s){this.i=t,this.t=s||[]}}const r=t=>s(`${t}-item`),a=t=>t.searchRegex&&t.label&&!t.empty?t.label.replace(t.searchRegex,"<mark>$&</mark>"):t.creating?`Press enter to create <mark>${t.searchString}</mark>`:t.empty?t.searchString||t.label?"No Items Found":"No Items":t.label||"",l=t=>t.label||"",c={canSelect:!0,cursorTimeout:150,filterRegex:t=>new RegExp(`\\b(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"i"),pageSize:10,type:"single"};class u{o(){if(!this.h)return;const t=this.l.querySelector(`#${this.h}`);t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}u(t){const s=`<ul class="jt-listbox" role="listbox" id="${this.p}" data-type="${this.m.type}"></ul>`;if(this.l=i(s),this.l.classList.add(...this.g.values()),"number"==typeof this.m.tabIndex&&this.l.setAttribute("tabindex",`${this.m.tabIndex}`),t instanceof HTMLElement)for(const s of t.children)if(s instanceof HTMLOptionElement||s instanceof HTMLOptGroupElement){if("placeholder"===s.dataset.role)continue;this.add(s)}else 3!==s.nodeType&&console.warn(`Unexpected element ${s.nodeName.toLowerCase()} in <${t.nodeName.toLowerCase()}>`);else Array.isArray(t)?t.forEach((t=>this.add(t))):console.error(`Unexpected type "${typeof t}" provided to _createDom`,t);const e=i(`<li class="jt-listbox__item" id="${this.p}-empty" data-empty="true" aria-hidden="true" hidden="true"></li>`);return e.classList.add(...this.v.values()),this.m.canCreate?e.setAttribute("role","option"):e.setAttribute("role","presentation"),this._(e),this.l.append(e),this.L(),this.l}k(t,s=!1){const e=t.key?t.key:r(this.p);document.querySelector(`#${e}`)&&!s&&console.error(`An element with key ${e} already exists.`);const{label:n,group:o,disabled:h,data:a}=t;n||console.warn("Label for <optgroup> is empty");const l=i(`\n<li class="jt-listbox__group" id="${e}">\n    <ul role="group" aria-labelledby="${e}-hdr">\n        <li role="presentation" class="jt-listbox__item jt-listbox__item--header" data-label="${n}" id="${e}-hdr"></li>\n    </ul>\n</li>`);l.classList.add(...this.$.values()),Object.keys(a||{}).length&&(l.dataset.itemData=JSON.stringify(a)),h&&l.setAttribute("aria-disabled","true");const c=l.querySelector('ul[role="group"]');if(!c)throw new Error("_createGroup did not render a ul[role=group]");const u=l.querySelector("li[role=presentation]");if(u.classList.add(...this.T.values()),!u)throw new Error("_createGroup did not render a li[role=presentation]");return u.dataset.groupId=e,u.dataset.itemData=JSON.stringify(a),this._(u),null==o||o.forEach((t=>{t.group?console.error("Nested option groups are not allowed"):c.append(this.C(t))})),l}C(t,s=!1){const e=t.key?t.key:r(this.p);document.querySelector(`#${e}`)&&!s&&console.error(`An element with key ${e} already exists.`);const{label:n,value:o,disabled:h,separator:a,data:l}=t;if(a){const t=i(`<li class="jt-listbox__item" id="${e}" role="separator"></li>`);return t.classList.add(...this.v.values()),t.dataset.itemData=JSON.stringify(l),this._(t),t}n||o||console.warn("Neither label nor value was specified for <option>"),this.l.querySelector(`[data-value="${o||n}"]`)&&!s&&console.warn(`An element with value ${o||n} already exists.`);const c=i(`<li class="jt-listbox__item" id="${e}" data-value="${o||n}" data-label="${n||o}" role="option"></li>`);return c.classList.add(...this.v.values()),Object.keys(l||{}).length&&(c.dataset.itemData=JSON.stringify(l)),l&&l.searchLabel&&(c.dataset.searchLabel=l.searchLabel),h&&c.setAttribute("aria-disabled","true"),this._(c),c}j(t){this.M=!0,this.H(),this.O(t),this.o(),setTimeout((()=>{this.M=!1}),this.m.cursorTimeout)}A(t){if(!t||!this.I(t))return;this.F=this.F.filter((s=>s!==t));const s=this.l.querySelector(`#${t}`);s&&s.removeAttribute("aria-checked")}S(t){for(const s of t){let t=s.target;if("characterData"===s.type&&(t=s.target.parentElement),!(t instanceof HTMLElement))return;if(t.getAttribute("data-jt-list-box")===this.p){for(const t of s.addedNodes)if(t instanceof HTMLOptGroupElement||t instanceof HTMLOptionElement){const s=n(t,(t=>t instanceof HTMLElement&&t.hasAttribute("data-key")));s instanceof HTMLElement?this.add(t,s.dataset.key):this.add(t,null)}for(const t of s.removedNodes)t instanceof HTMLElement&&t.hasAttribute("data-key")&&this.remove(t.dataset.key)}else if(s.target instanceof HTMLOptionElement||s.target instanceof HTMLOptGroupElement){const e=t.getAttribute("data-key");if(!e)continue;const i=this.l.querySelector(`#${e}`);if(!i)continue;const n=this.R(s.target,!1),o=s.target instanceof HTMLOptGroupElement?this.k(n,!0):this.C(n,!0);this.l.replaceChild(o,i),o.id=e}}}R(t,s=!0){var e;const i=t.disabled,n=t.dataset.key?t.dataset.key:r(this.p);if(s&&this.D&&(t.dataset.key=n,this.D.observe(t,{attributes:!0,characterData:"OPTION"===t.nodeName,childList:"OPTGROUP"===t.nodeName,subtree:!1})),t instanceof HTMLOptGroupElement){return{key:n,label:t.dataset.label?t.dataset.label:t.label.trim(),group:Array.from(t.querySelectorAll("option")).map((t=>this.R(t,s))).filter((t=>null!==t)),disabled:i,data:t.dataset}}if("separator"===t.dataset.role){return{key:n,disabled:i,separator:!0,data:(({key:t,label:s,role:e,...i})=>i)(t.dataset)}}{const s=t.value,h=t.dataset.label?t.dataset.label:t.label?t.label:(null===(e=t.textContent)||void 0===e?void 0:e.trim())||"",r=(({key:t,label:s,role:e,...i})=>i||{})(t.dataset);return{key:n,label:h||s,value:s||h,disabled:i,selected:o(t,"selected"),data:r}}}P(t){return"option"===t.getAttribute("role")&&!o(t,"aria-disabled")}I(t){return-1!==this.F.indexOf(t)}U(t){const s=this.l.querySelector(`#${t}`);if(s instanceof HTMLElement)return s.dataset.label}N(t){const s=t.target;if(s&&s instanceof HTMLElement&&this.P(s)){const e=new CustomEvent("item:click",{bubbles:!0,detail:{mouseEvent:t,value:s.dataset.value}});this.l.dispatchEvent(e)}}B(t){const s=t.target;s&&s instanceof HTMLElement&&this.P(s)&&!this.M&&(this.O(),this.H(s.id))}G(t){const s=t.target;s&&s instanceof HTMLElement&&s.matches(".jt-hover")&&!this.M&&(this.O(),this.H())}V(t){var s;const e={key:t.id||"",value:t.dataset.value,label:t.dataset.label,groupLabel:t.dataset.groupLabel,searchRegex:this.q||void 0,searchString:this.J||void 0,type:this.m.type||"single",data:{}};try{e.data=JSON.parse(t.dataset.itemData||"{}")}catch(t){}const i=null===(s=t.getAttribute("role"))||void 0===s?void 0:s.toLowerCase();return"option"===i?(e.disabled=o(t,"aria-disabled"),e.focused=this.h===t.id):"separator"===i?e.separator=!0:"true"===t.dataset.empty&&(e.creating=this.m.canCreate,e.empty=!0),e}_(t){var s;let e;const i=this.V(t),n=null===(s=t.getAttribute("role"))||void 0===s?void 0:s.toLowerCase();"option"===n||"separator"===n||"true"===t.dataset.empty?e=this.K||a:"presentation"===n&&(e=this.W||l),e?t.innerHTML=e(i):t.textContent=i.label||""}X(t){if(t&&!this.I(t))if("multiple"===this.m.type){const s=this.l.querySelector(`#${t}`);s instanceof HTMLElement&&(this.F.push(t),s.setAttribute("aria-checked","true"))}else if("single"===this.m.type)if(this.l.querySelectorAll("[role=option]").forEach((t=>{t.removeAttribute("aria-checked"),t.removeAttribute("aria-selected")})),null===t)this.F=[];else{const s=this.l.querySelector(`#${t}`);s&&(this.F=[t],s.setAttribute("aria-selected","true"))}}O(t){const s=this.l.querySelector(".jt-focused"),e=t?this.l.querySelector(`#${t}`):null;t&&s&&s.id===t||(s&&(s.dispatchEvent(new FocusEvent("item:focusout",{bubbles:!0,relatedTarget:e})),s.classList.remove("jt-focused"),this.h="",this._(s)),e instanceof HTMLElement&&this.P(e)&&(e.classList.add("jt-focused"),e.dispatchEvent(new FocusEvent("item:focusin",{bubbles:!0,relatedTarget:s})),this.h=t,this._(e)))}H(t){const s=this.l.querySelector(".jt-hover"),e=t?this.l.querySelector(`#${t}`):null;t&&s&&s.id===t||(s&&(s.classList.remove("jt-hover"),this.Y="",this._(s)),e instanceof HTMLElement&&this.P(e)&&(e.classList.add("jt-hover"),this.Y=t,this._(e)))}L(){let t=!1;this.l.querySelectorAll("[role=option]").forEach((s=>{if(!(s instanceof HTMLElement))return;const e=s.dataset.searchLabel?s.dataset.searchLabel:s.dataset.label;e&&this.J&&null===e.match(this.q)?(s.setAttribute("aria-hidden","true"),s.setAttribute("hidden","true")):(s.removeAttribute("aria-hidden"),s.removeAttribute("hidden"),t=!0),this._(s)}));const s=t=>"option"===t.getAttribute("role")&&!o(t,"hidden")&&!o(t,"aria-hidden");this.l.querySelectorAll("[role=separator]").forEach((function(t){n(t,s)&&function(t,s){let e=t.previousElementSibling;for(;e;){if(s(e))return e;e=e.previousElementSibling}return e}(t,s)?(t.removeAttribute("aria-hidden"),t.removeAttribute("hidden")):(t.setAttribute("aria-hidden","true"),t.setAttribute("hidden","true"))})),this.l.querySelectorAll("[role=presentation]").forEach((t=>{if(!(t instanceof HTMLElement))return;const e=t.closest(".jt-listbox__group");e&&(n(t,s)?(e.removeAttribute("aria-hidden"),e.removeAttribute("hidden")):(e.setAttribute("aria-hidden","true"),e.setAttribute("hidden","true")),this._(t))}));const e=this.l.querySelector(`#${this.p}-empty`);e instanceof HTMLElement&&(t?(e.setAttribute("aria-hidden","true"),e.setAttribute("hidden","true")):(e.removeAttribute("aria-hidden"),e.removeAttribute("hidden")),this._(e))}Z(t,s,...e){"list"===t?this.l.classList[s](...e):"group"===t?this.l.querySelectorAll('[role="group"]').forEach((t=>t.classList[s](...e))):"header"===t?this.l.querySelectorAll('[role="group"] [role="presentation"]').forEach((t=>t.classList[s](...e))):"item"===t&&this.l.querySelectorAll(".jt-listbox__item").forEach((t=>t.classList[s](...e)))}tt(t){const s=this.l.querySelector(`#${t}`);if(s instanceof HTMLElement)return s.dataset.value}st(){return this.l?Array.from(this.l.querySelectorAll("[role=option]")).filter((t=>!o(t,"aria-hidden")&&!o(t,"aria-disabled"))).filter((t=>!this.m.hideSelected||!this.I(t.id))).map((t=>t.id)):[]}add(t,s){let e,i=null;if("number"==typeof s){const t=Array.from(this.l.querySelectorAll("[role=option]"));s>0&&s<t.length&&(i=t[s])}else"string"==typeof s&&(i=this.l.querySelector(`#${s}`));const n=t instanceof HTMLElement?this.R(t):"object"==typeof t?t:{label:t};return n?(e=n.group?this.k(n):this.C(n),e?(i?i.insertAdjacentElement("beforebegin",e):this.l.append(e),n.selected&&("multiple"!==this.m.type&&""!==this.value&&console.warn(`Multiple selected options provided to ${this.p}`),this.X(e.id)),e):null):null}clear(){this.F=[],this.l.querySelectorAll("[role=option]").forEach((t=>{t.removeAttribute("aria-checked"),t.removeAttribute("aria-selected")}))}deselect(t){this.l.querySelectorAll(`[data-value="${t}"]`).forEach((t=>this.A(t.id)))}disconnect(){this.D&&this.D.disconnect();const t=document.querySelector(`[data-jt-list-box="${this.p}"]`);t&&t.removeAttribute("data-jt-list-box"),document.querySelectorAll(`option[data-key^="${this.p}"]`).forEach((t=>t.removeAttribute("data-key")))}focusClear(){this.H(),this.O()}focusDown(){const t=this.st(),s=t.indexOf(this.h||this.Y);s<t.length-1&&this.j(t[s+1])}focusEnd(){const t=this.st();t.length>0&&this.j(t[t.length-1])}focusHome(){const t=this.st();t.length>0&&this.j(t[0])}focusPageDown(){const t=this.st(),s=t.indexOf(this.h||this.Y);if(t.length>0){const e=Math.min(s+(this.m.pageSize||10),t.length-1);this.j(t[e])}}focusPageUp(){const t=this.st(),s=-1===t.indexOf(this.h||this.Y)?t.length:t.indexOf(this.h||this.Y);if(t.length>0){const e=Math.max(s-(this.m.pageSize||10),0);this.j(t[e])}}focusSelected(){0===this.F.length?this.focusHome():this.j(this.F[0])}focusTypeahead(t){if(!t)return;const s=t.toLowerCase(),e=this.st().map((t=>{var s;return[t,null===(s=this.U(t))||void 0===s?void 0:s.toLowerCase()]})).filter((t=>"string"==typeof t[1]&&t[1].startsWith(s)));if(!e.length)return void this.O();const i=e.findIndex((([t,s])=>t===this.h));i>=e.length-1?this.j(e[0][0]):this.j(e[i+1][0])}focusUp(){const t=this.st(),s=t.indexOf(this.h||this.Y);-1===s?this.j(t[t.length-1]):s>0&&this.j(t[s-1])}focusValue(t){const s=this.l.querySelector(`[data-value="${t}"]`);return!!(s&&s instanceof HTMLElement&&this.P(s))&&(this.j(s.id),!0)}item(t){let s=null;if("number"==typeof t){const e=Array.from(this.l.querySelectorAll("[role=option]"));t>0&&t<e.length&&(s=e[t])}else"string"==typeof t&&(s=this.l.querySelector(`#${t}`));return s instanceof HTMLLIElement?this.V(s):null}itemByValue(t){const s=document.querySelector(`[data-value="${t}"]`);return s instanceof HTMLLIElement?this.V(s):null}remove(t){let s=null;if("number"==typeof t){const e=Array.from(this.l.querySelectorAll("[role=option]"));t>0&&t<e.length&&(s=e[t])}else"string"==typeof t&&(s=this.l.querySelector(`#${t}`));s&&this.l.removeChild(s)}select(t){this.l.querySelectorAll(`[data-value="${t}"]`).forEach((t=>this.X(t.id)))}toggle(t){this.l.querySelectorAll(`[data-value="${t}"]`).forEach((t=>this.I(t.id)?this.A(t.id):this.X(t.id)))}get displayText(){const t=this.F.map((t=>this.U(t))).filter((t=>!!t));return"multiple"===this.m.type?t:"single"===this.m.type&&t.length?t[0]:""}get empty(){return 0===this.st().length}get filter(){return this.J}set filter(t){this.J=t,this.J?this.m.filterRegex?this.q=this.m.filterRegex(t):this.q=new RegExp(`\\b(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"i"):this.q=null,this.L()}get focusedId(){return this.h||this.Y}get focusedValue(){if(!this.h||this.Y)return"";const t=this.l.querySelector(`#${this.h||this.Y}`);return t&&t.dataset.value?t.dataset.value:""}get groupClassList(){return this.$}get headerClassList(){return this.T}get headerTemplate(){return this.W}set headerTemplate(t){this.W=t,this.L()}get listClassList(){return this.g}get itemClassList(){return this.v}get itemTemplate(){return this.K}set itemTemplate(t){this.K=t,this.L()}get root(){return this.l}get value(){const t=this.F.map((t=>this.tt(t))).filter((t=>!!t));return"multiple"===this.m.type?t:"single"===this.m.type&&t.length?t[0]:""}set value(t){if(this.clear(),"multiple"===this.m.type)Array.isArray(t)?t.forEach((t=>{this.select(t)})):this.select(t);else if("single"===this.m.type){if(Array.isArray(t))throw new Error("Cannot select multiple items");this.select(t)}}constructor(t,s,e){this.et=!1,this.M=!1,this.J="",this.h="",this.Y="",this.p="",this.q=null,this.F=[],this.p=t,this.m=Object.assign({},c,e||{}),this.$=new h(((t,...s)=>this.Z("group",t,...s)),this.m.groupListClasses||[]),this.T=new h(((t,...s)=>this.Z("header",t,...s)),this.m.groupHeaderClasses||[]),this.v=new h(((t,...s)=>this.Z("item",t,...s)),this.m.itemClasses||[]),this.g=new h(((t,...s)=>this.Z("list",t,...s)),this.m.listClasses||[]),this.W=this.m.groupHeaderTemplate||null,this.K=this.m.itemTemplate||null,this.D=new MutationObserver((t=>this.S(t))),s instanceof HTMLElement&&(s.dataset.jtListBox=this.p,this.D.observe(s,{childList:!0})),this.l=this.u(s),this.l.addEventListener("click",(t=>this.N(t)),{capture:!0}),this.l.addEventListener("pointerenter",(t=>this.B(t)),{capture:!0}),this.l.addEventListener("pointerleave",(t=>this.G(t)),{capture:!0})}}function d(t,s){const e=Object.keys(s),i=Object.values(s);return new Function(...e,`return \`${t}\`;`)(...i)}const f=["text","search","url","tel","email"];class p extends HTMLElement{get disabled(){var t;return!!(null===(t=this.it)||void 0===t?void 0:t.disabled)}set disabled(t){t?(this.setAttribute("aria-disabled","true"),this.setAttribute("disabled","")):(this.removeAttribute("aria-disabled"),this.removeAttribute("disabled")),this.nt.disabled=t,this.ot&&(this.ot.disabled=t),this.it.disabled!=t&&(this.it.disabled=t)}get groupClass(){return this.getAttribute("groupclass")}set groupClass(t){this.setAttribute("groupclass",t)}get groupClassList(){return this.ht.groupClassList}get headerClass(){return this.getAttribute("headerclass")}set headerClass(t){this.setAttribute("headerclass",t)}get headerClassList(){return this.ht.headerClassList}get headerTemplate(){return this.W}set headerTemplate(t){"function"==typeof t?(this.setAttribute("headertemplate","function"),this.W=t,this.ht.headerTemplate=t):"string"==typeof t?this.setAttribute("headertemplate",t):t||this.removeAttribute("headertemplate")}get itemClass(){return this.getAttribute("itemclass")}set itemClass(t){this.setAttribute("itemclass",t)}get itemClassList(){return this.ht.itemClassList}get itemTemplate(){return this.K}set itemTemplate(t){"function"==typeof t?(this.setAttribute("itemtemplate","function"),this.K=t,this.ht.itemTemplate=t):"string"==typeof t?this.setAttribute("itemtemplate",t):t||this.removeAttribute("itemtemplate")}get listClass(){return this.getAttribute("listclass")}set listClass(t){this.setAttribute("listclass",t)}get listClassList(){return this.ht.listClassList}get open(){return o(this.it,"aria-expanded")}set open(t){t&&!this.disabled?this.rt():this.lt()}get readOnly(){return this.it.readOnly}set readOnly(t){t?(this.setAttribute("aria-readonly","true"),this.setAttribute("readonly","")):(this.removeAttribute("aria-readonly"),this.removeAttribute("readonly")),this.it.readOnly!=t&&(this.it.readOnly=t)}ct(){if(!this.ut&&this.dt)if("#"==this.dt[0]){const t=document.querySelector(this.dt);t instanceof HTMLElement&&this.ft(t)}else fetch(this.dt).then((t=>t.json())).then((t=>this.ft(t))).catch((t=>{throw new Error(t)}))}lt(){this.classList.remove("jt-open"),this.it.setAttribute("aria-expanded","false"),this.nt.setAttribute("aria-expanded","false"),this.ht.focusClear(),this.ht.filter=""}bt(t){for(const s of t)switch(s.attributeName){case"disabled":this.disabled=this.it.disabled;break;case"readonly":this.readOnly=this.it.readOnly;break;case"list":if(this.it.hasAttribute("list")&&this.it.getAttribute("list")){this.lt(),this.ut=!1,this.dt=`#${this.it.getAttribute("list")}`,this.it.removeAttribute("list");break}}}gt(){this.yt=!1,this.vt=!1,this.it.parentElement.classList.remove("jt-focus"),this.ht.root.classList.remove("jt-focus")}wt(){this.yt=!0,this.vt=!1,this.it.parentElement.classList.remove("jt-focus"),this.ht.root.classList.add("jt-focus")}xt(){this.yt=!1,this.vt=!0,this.it.parentElement.classList.add("jt-focus"),this.ht.root.classList.remove("jt-focus")}_t(){return{groupListClasses:this.groupClass?[...this.groupClass.split(" ")]:[],groupHeaderClasses:this.headerClass?[...this.headerClass.split(" ")]:[],itemClasses:this.itemClass?[...this.itemClass.split(" ")]:[],listClasses:this.listClass?[...this.listClass.split(" ")]:[],groupHeaderTemplate:this.W,itemTemplate:this.K,type:"single"}}Lt(t){if(!t)return null;if(t.includes("${"))return s=>d(t,{item:s});try{const s=document.querySelector(`#${t}`);if(s instanceof HTMLElement)return t=>d(s.innerHTML,{item:t})}catch(t){}return null}N(){this.disabled||this.readOnly||(this.open=!this.open)}kt(t){const s=t.target;s instanceof HTMLElement&&null===s.closest(`#${this.p}`)&&this.lt()}Et(){this.xt()}$t(){this.gt()}Tt(){this.open||this.rt(),this.ht.focusValue(this.ht.filter),this.ht.filter=this.it.value}Ct(t){this.readOnly||this.jt(t.detail.value),this.lt()}Mt(t){t.target instanceof HTMLElement&&""!==t.target.id?this.it.setAttribute("aria-activedescendant",t.target.id):this.it.removeAttribute("aria-activedescendant")}Ht(t){t.relatedTarget instanceof HTMLElement&&""!==t.relatedTarget.id?this.it.setAttribute("aria-activedescendant",t.relatedTarget.id):this.it.removeAttribute("aria-activedescendant")}Ot(t){let s=!1;const e=this.yt;switch(t.key){case"Enter":this.yt&&this.ht.focusedId?(this.jt(this.ht.focusedValue),this.lt(),this.xt(),s=!0):this.open&&(this.lt(),this.xt(),s=!0);break;case"Esc":case"Escape":this.open?(this.lt(),this.xt()):this.jt(""),s=!0;break;case"ArrowDown":case"Down":this.rt(),this.wt(),t.altKey||this.ht.focusedId&&!e||this.ht.focusDown(),s=!0;break;case"ArrowUp":case"Up":this.ht.empty||(this.rt(),this.wt(),t.altKey||this.ht.focusedId&&!e||this.ht.focusUp()),s=!0;break;case"Tab":""!==this.ht.focusedId&&this.jt(this.ht.focusedValue),this.lt()}s&&(t.stopPropagation(),t.preventDefault())}At(t){let s=!1;if(1===t.key.length&&t.key.match(/\S| /))this.ht.filter=this.it.value;else if("Escape"===t.key||"Esc"===t.key||"Enter"==t.key)return;switch(t.key){case"Backspace":this.xt(),this.ht.focusClear(),this.ht.filter=this.it.value,s=!0;break;case"Left":case"ArrowLeft":case"Right":case"ArrowRight":case"Home":case"End":this.xt(),this.ht.focusClear(),s=!0;break;default:this.ht.empty||(this.open||this.rt(),this.ht.focusValue(this.ht.filter)),s=!0}s&&(t.stopPropagation(),t.preventDefault())}It(){this.disabled||(this.open=!this.open)}rt(){this.ct(),this.open||(this.classList.add("jt-open"),this.it.setAttribute("aria-expanded","true"),this.nt.setAttribute("aria-expanded","true"),this.readOnly||this.ht.focusValue(this.it.value)||(this.querySelector(".jt-popup").scrollTop=0),document.activeElement!==this.it&&this.it.focus())}ft(t){const s=new u(`${this.p}-listbox`,t,this._t());this.ht.root.replaceWith(s.root),this.ht=s,this.ut=!0,this.ht.root.addEventListener("item:click",(t=>this.Ct(t))),this.ht.root.addEventListener("item:focusin",(t=>this.Mt(t))),this.ht.root.addEventListener("item:focusout",(t=>this.Ht(t)))}jt(t){this.readOnly||(this.ht.filter=t,this.it.value=t,this.it.setSelectionRange(t.length,t.length),this.it.dispatchEvent(new Event("input")))}Ft(){if(!this.isConnected)return;if(this.hasAttribute("id")||this.setAttribute("id",this.p),this.it=this.querySelector("input"),!this.it)return;if(!f.includes(this.it.type||"text"))throw new Error(`JtAutocomplete does not support <input type='${this.it.type}'>`);this.it.hasAttribute("autocomplete")||this.it.setAttribute("autocomplete","off"),this.it.setAttribute("role","combobox"),this.it.setAttribute("aria-autocomplete","list"),this.it.addEventListener("click",(()=>this.N())),this.it.addEventListener("focusin",(()=>this.Et())),this.it.addEventListener("focusout",(()=>this.$t())),this.it.addEventListener("input",(()=>this.Tt())),this.it.addEventListener("keydown",(t=>this.Ot(t))),this.it.addEventListener("keyup",(t=>this.At(t))),this.St=i(`<button type='button' data-action='close' id="${this.p}-close" tabindex="-1"><span class='jt-sr-only'>Close Suggestion List</span></button>`),this.St.addEventListener("click",(()=>this.lt())),this.nt=i(`<button type='button' data-action='open' id='${this.p}-open' tabindex="-1"><span class='jt-sr-only'>Show Suggestions<span></button>`),this.nt.addEventListener("click",(()=>this.It())),this.ot=i(`<button type='button' data-action='clear' id='${this.p}-clear' tabindex="-1"><span class='jt-sr-only'>Clear Input</span></button>`),this.ot.addEventListener("click",(()=>this.clear()));const t=document.createElement("div");t.classList.add("jt-control__buttons"),t.appendChild(this.nt),t.appendChild(this.ot);const s=document.createElement("div");s.classList.add("jt-control"),s.appendChild(this.St),s.appendChild(this.it),s.appendChild(t),this.appendChild(s),this.ut=!1,this.hasAttribute("src")?this.dt=this.getAttribute("src"):this.hasAttribute("list")?this.dt=`#${this.getAttribute("list")}`:this.it.hasAttribute("list")&&(this.setAttribute("list",this.it.getAttribute("list")),this.dt=`#${this.it.getAttribute("list")}`,this.it.setAttribute("list",""),this.it.removeAttribute("list")),this.ht=new u(`${this.p}-listbox`,[],this._t()),this.ht.groupClassList.value=this.getAttribute("groupClass"),this.ht.headerClassList.value=this.getAttribute("headerClass"),this.ht.itemClassList.value=this.getAttribute("itemClass"),this.ht.listClassList.value=this.getAttribute("listClass");const e=document.createElement("div");e.classList.add("jt-popup"),e.appendChild(this.ht.root),this.appendChild(e),this.open=!1,this.disabled=this.it.disabled,this.readOnly=this.it.readOnly,this.classList.toggle("jt-placeholder-shown",""==this.it.value),this.it.addEventListener("input",(()=>{this.classList.toggle("jt-placeholder-shown",""==this.it.value)})),this.D=new MutationObserver((t=>this.bt(t))),this.D.observe(this.it,{attributes:!0}),document.addEventListener("click",(t=>this.kt(t)))}clear(){this.jt(""),requestAnimationFrame((()=>{this.it.focus()}))}matchingItem(){return this.it.value?this.ht.itemByValue(this.it.value):null}constructor(){super(),this.p=this.getAttribute("id")||s("jt-autocomplete")}static get observedAttributes(){return["groupclass","headerclass","headertemplate","itemclass","itemtemplate","listclass","src"]}attributeChangedCallback(t,s,e){switch(t){case"groupclass":this.ht.groupClassList.value=e;break;case"headerclass":this.ht.headerClassList.value=e;break;case"itemclass":this.ht.itemClassList.value=e;break;case"listclass":this.ht.listClassList.value=e;break;case"headertemplate":null===e?(this.W=null,this.ht.headerTemplate=null):"function"!==e&&(this.W=this.Lt(e),this.ht.headerTemplate=this.W);break;case"itemtemplate":null===e?(this.K=null,this.ht.itemTemplate=null):"function"!==e&&(this.K=this.Lt(e),this.ht.itemTemplate=this.K);break;case"src":this.lt(),this.ut=!1,this.dt=e}}connectedCallback(){setTimeout((()=>this.Ft()),0)}static register(){customElements.define("jt-autocomplete",p)}}function m(t){return t.split("-")[1]}function b(t){return"y"===t?"height":"width"}function g(t){return t.split("-")[0]}function y(t){return["top","bottom"].includes(g(t))?"x":"y"}function v(t,s,e){let{reference:i,floating:n}=t;const o=i.x+i.width/2-n.width/2,h=i.y+i.height/2-n.height/2,r=y(s),a=b(r),l=i[a]/2-n[a]/2,c="x"===r;let u;switch(g(s)){case"top":u={x:o,y:i.y-n.height};break;case"bottom":u={x:o,y:i.y+i.height};break;case"right":u={x:i.x+i.width,y:h};break;case"left":u={x:i.x-n.width,y:h};break;default:u={x:i.x,y:i.y}}switch(m(s)){case"start":u[r]-=l*(e&&c?-1:1);break;case"end":u[r]+=l*(e&&c?-1:1)}return u}"boolean"==typeof __ROLLUP_IIFE&&__ROLLUP_IIFE&&p.register();function w(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}async function x(t,s){var e;void 0===s&&(s={});const{x:i,y:n,platform:o,rects:h,elements:r,strategy:a}=t,{boundary:l="clippingAncestors",rootBoundary:c="viewport",elementContext:u="floating",altBoundary:d=!1,padding:f=0}=s,p=function(t){return"number"!=typeof t?function(t){return{top:0,right:0,bottom:0,left:0,...t}}(t):{top:t,right:t,bottom:t,left:t}}(f),m=r[d?"floating"===u?"reference":"floating":u],b=w(await o.getClippingRect({element:null==(e=await(null==o.isElement?void 0:o.isElement(m)))||e?m:m.contextElement||await(null==o.getDocumentElement?void 0:o.getDocumentElement(r.floating)),boundary:l,rootBoundary:c,strategy:a})),g="floating"===u?{...h.floating,x:i,y:n}:h.reference,y=await(null==o.getOffsetParent?void 0:o.getOffsetParent(r.floating)),v=await(null==o.isElement?void 0:o.isElement(y))&&await(null==o.getScale?void 0:o.getScale(y))||{x:1,y:1},x=w(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:g,offsetParent:y,strategy:a}):g);return{top:(b.top-x.top+p.top)/v.y,bottom:(x.bottom-b.bottom+p.bottom)/v.y,left:(b.left-x.left+p.left)/v.x,right:(x.right-b.right+p.right)/v.x}}const _=Math.min,L=Math.max;function k(t,s,e){return L(t,_(s,e))}const E={left:"right",right:"left",bottom:"top",top:"bottom"};function $(t){return t.replace(/left|right|bottom|top/g,(t=>E[t]))}const T={start:"end",end:"start"};function C(t){return t.replace(/start|end/g,(t=>T[t]))}const j=function(t){return void 0===t&&(t={}),{name:"flip",options:t,async fn(s){var e;const{placement:i,middlewareData:n,rects:o,initialPlacement:h,platform:r,elements:a}=s,{mainAxis:l=!0,crossAxis:c=!0,fallbackPlacements:u,fallbackStrategy:d="bestFit",fallbackAxisSideDirection:f="none",flipAlignment:p=!0,...v}=t,w=g(i),_=g(h)===h,L=await(null==r.isRTL?void 0:r.isRTL(a.floating)),k=u||(_||!p?[$(h)]:function(t){const s=$(t);return[C(t),s,C(s)]}(h));u||"none"===f||k.push(...function(t,s,e,i){const n=m(t);let o=function(t,s,e){const i=["left","right"],n=["right","left"],o=["top","bottom"],h=["bottom","top"];switch(t){case"top":case"bottom":return e?s?n:i:s?i:n;case"left":case"right":return s?o:h;default:return[]}}(g(t),"start"===e,i);return n&&(o=o.map((t=>t+"-"+n)),s&&(o=o.concat(o.map(C)))),o}(h,p,f,L));const E=[h,...k],T=await x(s,v),j=[];let M=(null==(e=n.flip)?void 0:e.overflows)||[];if(l&&j.push(T[w]),c){const{main:t,cross:s}=function(t,s,e){void 0===e&&(e=!1);const i=m(t),n=y(t),o=b(n);let h="x"===n?i===(e?"end":"start")?"right":"left":"start"===i?"bottom":"top";return s.reference[o]>s.floating[o]&&(h=$(h)),{main:h,cross:$(h)}}(i,o,L);j.push(T[t],T[s])}if(M=[...M,{placement:i,overflows:j}],!j.every((t=>t<=0))){var H,O;const t=((null==(H=n.flip)?void 0:H.index)||0)+1,s=E[t];if(s)return{data:{index:t,overflows:M},reset:{placement:s}};let e=null==(O=M.filter((t=>t.overflows[0]<=0)).sort(((t,s)=>t.overflows[1]-s.overflows[1]))[0])?void 0:O.placement;if(!e)switch(d){case"bestFit":{var A;const t=null==(A=M.map((t=>[t.placement,t.overflows.filter((t=>t>0)).reduce(((t,s)=>t+s),0)])).sort(((t,s)=>t[1]-s[1]))[0])?void 0:A[0];t&&(e=t);break}case"initialPlacement":e=h}if(i!==e)return{reset:{placement:e}}}return{}}}};const M=function(t){return void 0===t&&(t=0),{name:"offset",options:t,async fn(s){const{x:e,y:i}=s,n=await async function(t,s){const{placement:e,platform:i,elements:n}=t,o=await(null==i.isRTL?void 0:i.isRTL(n.floating)),h=g(e),r=m(e),a="x"===y(e),l=["left","top"].includes(h)?-1:1,c=o&&a?-1:1,u="function"==typeof s?s(t):s;let{mainAxis:d,crossAxis:f,alignmentAxis:p}="number"==typeof u?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...u};return r&&"number"==typeof p&&(f="end"===r?-1*p:p),a?{x:f*c,y:d*l}:{x:d*l,y:f*c}}(s,t);return{x:e+n.x,y:i+n.y,data:n}}}};function H(t){var s;return(null==(s=t.ownerDocument)?void 0:s.defaultView)||window}function O(t){return H(t).getComputedStyle(t)}function A(t){return t instanceof H(t).Node}function I(t){return A(t)?(t.nodeName||"").toLowerCase():""}function F(t){return t instanceof H(t).HTMLElement}function S(t){return t instanceof H(t).Element}function R(t){if("undefined"==typeof ShadowRoot)return!1;return t instanceof H(t).ShadowRoot||t instanceof ShadowRoot}function D(t){const{overflow:s,overflowX:e,overflowY:i,display:n}=O(t);return/auto|scroll|overlay|hidden|clip/.test(s+i+e)&&!["inline","contents"].includes(n)}function P(t){return["table","td","th"].includes(I(t))}function U(t){const s=N(),e=O(t);return"none"!==e.transform||"none"!==e.perspective||!s&&!!e.backdropFilter&&"none"!==e.backdropFilter||!s&&!!e.filter&&"none"!==e.filter||["transform","perspective","filter"].some((t=>(e.willChange||"").includes(t)))||["paint","layout","strict","content"].some((t=>(e.contain||"").includes(t)))}function N(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function B(t){return["html","body","#document"].includes(I(t))}const G=Math.min,V=Math.max,q=Math.round;function z(t){const s=O(t);let e=parseFloat(s.width)||0,i=parseFloat(s.height)||0;const n=F(t),o=n?t.offsetWidth:e,h=n?t.offsetHeight:i,r=q(e)!==o||q(i)!==h;return r&&(e=o,i=h),{width:e,height:i,fallback:r}}function J(t){return S(t)?t:t.contextElement}const K={x:1,y:1};function W(t){const s=J(t);if(!F(s))return K;const e=s.getBoundingClientRect(),{width:i,height:n,fallback:o}=z(s);let h=(o?q(e.width):e.width)/i,r=(o?q(e.height):e.height)/n;return h&&Number.isFinite(h)||(h=1),r&&Number.isFinite(r)||(r=1),{x:h,y:r}}const X={x:0,y:0};function Y(t,s,e){var i,n;if(void 0===s&&(s=!0),!N())return X;const o=t?H(t):window;return!e||s&&e!==o?X:{x:(null==(i=o.visualViewport)?void 0:i.offsetLeft)||0,y:(null==(n=o.visualViewport)?void 0:n.offsetTop)||0}}function Q(t,s,e,i){void 0===s&&(s=!1),void 0===e&&(e=!1);const n=t.getBoundingClientRect(),o=J(t);let h=K;s&&(i?S(i)&&(h=W(i)):h=W(t));const r=Y(o,e,i);let a=(n.left+r.x)/h.x,l=(n.top+r.y)/h.y,c=n.width/h.x,u=n.height/h.y;if(o){const t=H(o),s=i&&S(i)?H(i):i;let e=t.frameElement;for(;e&&i&&s!==t;){const t=W(e),s=e.getBoundingClientRect(),i=getComputedStyle(e);s.x+=(e.clientLeft+parseFloat(i.paddingLeft))*t.x,s.y+=(e.clientTop+parseFloat(i.paddingTop))*t.y,a*=t.x,l*=t.y,c*=t.x,u*=t.y,a+=s.x,l+=s.y,e=H(e).frameElement}}return w({width:c,height:u,x:a,y:l})}function Z(t){return((A(t)?t.ownerDocument:t.document)||window.document).documentElement}function tt(t){return S(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function st(t){return Q(Z(t)).left+tt(t).scrollLeft}function et(t){if("html"===I(t))return t;const s=t.assignedSlot||t.parentNode||R(t)&&t.host||Z(t);return R(s)?s.host:s}function it(t){const s=et(t);return B(s)?s.ownerDocument.body:F(s)&&D(s)?s:it(s)}function nt(t,s){var e;void 0===s&&(s=[]);const i=it(t),n=i===(null==(e=t.ownerDocument)?void 0:e.body),o=H(i);return n?s.concat(o,o.visualViewport||[],D(i)?i:[]):s.concat(i,nt(i))}function ot(t,s,e){let i;if("viewport"===s)i=function(t,s){const e=H(t),i=Z(t),n=e.visualViewport;let o=i.clientWidth,h=i.clientHeight,r=0,a=0;if(n){o=n.width,h=n.height;const t=N();(!t||t&&"fixed"===s)&&(r=n.offsetLeft,a=n.offsetTop)}return{width:o,height:h,x:r,y:a}}(t,e);else if("document"===s)i=function(t){const s=Z(t),e=tt(t),i=t.ownerDocument.body,n=V(s.scrollWidth,s.clientWidth,i.scrollWidth,i.clientWidth),o=V(s.scrollHeight,s.clientHeight,i.scrollHeight,i.clientHeight);let h=-e.scrollLeft+st(t);const r=-e.scrollTop;return"rtl"===O(i).direction&&(h+=V(s.clientWidth,i.clientWidth)-n),{width:n,height:o,x:h,y:r}}(Z(t));else if(S(s))i=function(t,s){const e=Q(t,!0,"fixed"===s),i=e.top+t.clientTop,n=e.left+t.clientLeft,o=F(t)?W(t):{x:1,y:1};return{width:t.clientWidth*o.x,height:t.clientHeight*o.y,x:n*o.x,y:i*o.y}}(s,e);else{const e=Y(t);i={...s,x:s.x-e.x,y:s.y-e.y}}return w(i)}function ht(t,s){const e=et(t);return!(e===s||!S(e)||B(e))&&("fixed"===O(e).position||ht(e,s))}function rt(t,s){return F(t)&&"fixed"!==O(t).position?s?s(t):t.offsetParent:null}function at(t,s){const e=H(t);if(!F(t))return e;let i=rt(t,s);for(;i&&P(i)&&"static"===O(i).position;)i=rt(i,s);return i&&("html"===I(i)||"body"===I(i)&&"static"===O(i).position&&!U(i))?e:i||function(t){let s=et(t);for(;F(s)&&!B(s);){if(U(s))return s;s=et(s)}return null}(t)||e}function lt(t,s,e){const i=F(s),n=Z(s),o="fixed"===e,h=Q(t,!0,o,s);let r={scrollLeft:0,scrollTop:0};const a={x:0,y:0};if(i||!i&&!o)if(("body"!==I(s)||D(n))&&(r=tt(s)),F(s)){const t=Q(s,!0,o,s);a.x=t.x+s.clientLeft,a.y=t.y+s.clientTop}else n&&(a.x=st(n));return{x:h.left+r.scrollLeft-a.x,y:h.top+r.scrollTop-a.y,width:h.width,height:h.height}}const ct={getClippingRect:function(t){let{element:s,boundary:e,rootBoundary:i,strategy:n}=t;const o=[..."clippingAncestors"===e?function(t,s){const e=s.get(t);if(e)return e;let i=nt(t).filter((t=>S(t)&&"body"!==I(t))),n=null;const o="fixed"===O(t).position;let h=o?et(t):t;for(;S(h)&&!B(h);){const s=O(h),e=U(h);e||"fixed"!==s.position||(n=null),(o?!e&&!n:!e&&"static"===s.position&&n&&["absolute","fixed"].includes(n.position)||D(h)&&!e&&ht(t,h))?i=i.filter((t=>t!==h)):n=s,h=et(h)}return s.set(t,i),i}(s,this.Rt):[].concat(e),i],h=o[0],r=o.reduce(((t,e)=>{const i=ot(s,e,n);return t.top=V(i.top,t.top),t.right=G(i.right,t.right),t.bottom=G(i.bottom,t.bottom),t.left=V(i.left,t.left),t}),ot(s,h,n));return{width:r.right-r.left,height:r.bottom-r.top,x:r.left,y:r.top}},convertOffsetParentRelativeRectToViewportRelativeRect:function(t){let{rect:s,offsetParent:e,strategy:i}=t;const n=F(e),o=Z(e);if(e===o)return s;let h={scrollLeft:0,scrollTop:0},r={x:1,y:1};const a={x:0,y:0};if((n||!n&&"fixed"!==i)&&(("body"!==I(e)||D(o))&&(h=tt(e)),F(e))){const t=Q(e);r=W(e),a.x=t.x+e.clientLeft,a.y=t.y+e.clientTop}return{width:s.width*r.x,height:s.height*r.y,x:s.x*r.x-h.scrollLeft*r.x+a.x,y:s.y*r.y-h.scrollTop*r.y+a.y}},isElement:S,getDimensions:function(t){return z(t)},getOffsetParent:at,getDocumentElement:Z,getScale:W,async getElementRects(t){let{reference:s,floating:e,strategy:i}=t;const n=this.getOffsetParent||at,o=this.getDimensions;return{reference:lt(s,await n(e),i),floating:{x:0,y:0,...await o(e)}}},getClientRects:t=>Array.from(t.getClientRects()),isRTL:t=>"rtl"===O(t).direction};const ut=(t,s,e)=>{const i=new Map,n={platform:ct,...e},o={...n.platform,Rt:i};return(async(t,s,e)=>{const{placement:i="bottom",strategy:n="absolute",middleware:o=[],platform:h}=e,r=o.filter(Boolean),a=await(null==h.isRTL?void 0:h.isRTL(s));let l=await h.getElementRects({reference:t,floating:s,strategy:n}),{x:c,y:u}=v(l,i,a),d=i,f={},p=0;for(let e=0;e<r.length;e++){const{name:o,fn:m}=r[e],{x:b,y:g,data:y,reset:w}=await m({x:c,y:u,initialPlacement:i,placement:d,strategy:n,middlewareData:f,rects:l,platform:h,elements:{reference:t,floating:s}});c=null!=b?b:c,u=null!=g?g:u,f={...f,[o]:{...f[o],...y}},w&&p<=50&&(p++,"object"==typeof w&&(w.placement&&(d=w.placement),w.rects&&(l=!0===w.rects?await h.getElementRects({reference:t,floating:s,strategy:n}):w.rects),({x:c,y:u}=v(l,d,a))),e=-1)}return{x:c,y:u,placement:d,strategy:n,middlewareData:f}})(t,s,{...n,platform:o})},dt=new Map,ft="rtl"===window.getComputedStyle(document.documentElement).direction,pt={LEFT:37,UP:38,RIGHT:39,DOWN:40},mt=t=>{const{currentTarget:s}=t;dt.get("last_rover")!=s&&dt.has(s)&&(wt(s,dt.get(s).active),dt.set("last_rover",s))},bt=t=>{const{currentTarget:s}=t;switch(t.keyCode){case pt[ft?"LEFT":"RIGHT"]:case pt.DOWN:t.preventDefault(),yt(s);break;case pt[ft?"RIGHT":"LEFT"]:case pt.UP:t.preventDefault(),vt(s)}},gt=new MutationObserver(((t,s)=>{t.filter((t=>t.removedNodes.length>0)).forEach((t=>{[...t.removedNodes].filter((t=>1===t.nodeType)).forEach((t=>{dt.forEach(((s,e)=>{"last_rover"!==e&&t.contains(e)&&(e.removeEventListener("focusin",mt),e.removeEventListener("keydown",bt),dt.delete(e),s.targets.forEach((t=>t.tabIndex="")),(0===dt.size||1===dt.size&&dt.has("last_rover"))&&(dt.clear(),gt.disconnect()))}))}))}))})),yt=t=>{const s=dt.get(t);s.index+=1,s.index>s.targets.length-1&&(s.index=s.targets.length-1);let e=s.targets[s.index];e&&wt(t,e)},vt=t=>{const s=dt.get(t);s.index-=1,s.index<1&&(s.index=0);let e=s.targets[s.index];e&&wt(t,e)},wt=(t,s)=>{const e=dt.get(t);e.active.tabIndex=-1,e.active=s,e.active.tabIndex=0,e.active.focus()};class xt extends HTMLElement{Et(t){t.currentTarget instanceof Element&&t.currentTarget.closest(`#${this.p}`)&&(this.open(),this.Dt())}$t(t){t.currentTarget instanceof Element&&t.currentTarget.closest(`#${this.p}`)&&this.close()}Dt(){const t=this.getAttribute("alignment")||"center",s=this.getAttribute("placement")||"right";this.Pt=this.getAttribute("offset")?parseInt(this.getAttribute("offset")):null,this.Ut=`${s}${"center"!==t?"-"+t:""}`,this.Nt=this.getAttribute("selector")||"button",this.Bt&&this.Gt&&function(t,s,e,i){void 0===i&&(i={});const{ancestorScroll:n=!0,ancestorResize:o=!0,elementResize:h=!0,animationFrame:r=!1}=i,a=n||o?[...S(t)?nt(t):t.contextElement?nt(t.contextElement):[],...nt(s)]:[];a.forEach((t=>{const s=!S(t)&&t.toString().includes("V");!n||r&&!s||t.addEventListener("scroll",e,{passive:!0}),o&&t.addEventListener("resize",e)}));let l,c=null;h&&(c=new ResizeObserver((()=>{e()})),S(t)&&!r&&c.observe(t),S(t)||!t.contextElement||r||c.observe(t.contextElement),c.observe(s));let u=r?Q(t):null;r&&function s(){const i=Q(t);!u||i.x===u.x&&i.y===u.y&&i.width===u.width&&i.height===u.height||e(),u=i,l=requestAnimationFrame(s)}(),e()}(this.Bt,this.Gt,(()=>{var t;ut(this.Bt,this.Gt,{placement:this.Ut,middleware:[j(),(void 0===t&&(t={}),{name:"shift",options:t,async fn(s){const{x:e,y:i,placement:n}=s,{mainAxis:o=!0,crossAxis:h=!1,limiter:r={fn:t=>{let{x:s,y:e}=t;return{x:s,y:e}}},...a}=t,l={x:e,y:i},c=await x(s,a),u=y(g(n)),d="x"===u?"y":"x";let f=l[u],p=l[d];if(o){const t="y"===u?"bottom":"right";f=k(f+c["y"===u?"top":"left"],f,f-c[t])}if(h){const t="y"===d?"bottom":"right";p=k(p+c["y"===d?"top":"left"],p,p-c[t])}const m=r.fn({...s,[u]:f,[d]:p});return{...m,data:{x:m.x-e,y:m.y-i}}}}),this.Pt&&M(this.Pt)]}).then((({x:t,y:s})=>{Object.assign(this.Gt.style,{left:`${t}px`,top:`${s}px`})}))}))}Ft(){if(!this.isConnected)return;this.hasAttribute("id")||this.setAttribute("id",this.p),this.Bt=this.querySelector("[slot=trigger]"),this.Gt=this.querySelector("[slot=target]"),this.Gt.classList.add("jt-popup__popup"),this.Gt.hasAttribute("id")||this.Gt.setAttribute("id",`${this.p}-menu`);const t=document.createElement("div");t.classList.add("jt-popup"),t.setAttribute("aria-haspopup","true"),t.setAttribute("aria-controls",this.Gt.getAttribute("id")),t.setAttribute("aria-expanded","false"),t.appendChild(this.Bt),t.appendChild(this.Gt),this.appendChild(t),(({element:t,target:s})=>{const e=t.querySelectorAll(s||":scope *"),i=e[0];t.tabIndex=-1,e.forEach((t=>t.tabIndex=-1)),i.tabIndex=0,dt.set(t,{targets:e,active:i,index:0}),t.addEventListener("focusin",mt),t.addEventListener("keydown",bt),gt.observe(document,{childList:!0,subtree:!0})})({element:t,target:`[slot=target] ${this.Nt}`}),t.addEventListener("focusin",(t=>this.Et(t))),t.addEventListener("focusout",(t=>this.$t(t))),t.addEventListener("keyup",(t=>"Escape"===t.code&&t.target instanceof HTMLElement&&t.target.blur())),this.Bt.setAttribute("tabindex","-1"),this.Bt.addEventListener("click",(()=>{const t=this.querySelector(`[slot=target] ${this.Nt}`);t instanceof HTMLElement&&t.focus()}))}close(){this.querySelector("div").setAttribute("aria-expanded","false")}open(){this.querySelector("div").setAttribute("aria-expanded","true")}constructor(){super(),this.p=this.getAttribute("id")||s("jt-popup-menu")}static get observedAttributes(){return["alignment","placement","offset"]}attributeChangedCallback(t){switch(t){case"alignment":case"placement":case"offset":this.Dt()}}connectedCallback(){setTimeout((()=>this.Ft()),0)}static register(){customElements.define("jt-popup-menu",xt)}}"boolean"==typeof __ROLLUP_IIFE&&__ROLLUP_IIFE&&xt.register();class _t extends HTMLElement{get disabled(){return o(this,"disabled")}set disabled(t){t?(this.setAttribute("aria-disabled","true"),this.setAttribute("disabled",""),this.Vt.setAttribute("aria-disabled","true"),this.X.setAttribute("disabled","")):(this.removeAttribute("aria-disabled"),this.removeAttribute("disabled"),this.Vt.removeAttribute("aria-disabled"),this.X.removeAttribute("disabled")),this.ot&&(this.ot.disabled=t)}get groupClass(){return this.getAttribute("groupclass")}set groupClass(t){this.setAttribute("groupclass",t)}get groupClassList(){return this.ht.groupClassList}get headerClass(){return this.getAttribute("headerclass")}set headerClass(t){this.setAttribute("headerclass",t)}get headerClassList(){return this.ht.headerClassList}get headerTemplate(){return this.W}set headerTemplate(t){"function"==typeof t?(this.setAttribute("headertemplate","function"),this.W=t,this.ht.headerTemplate=t):"string"==typeof t?this.setAttribute("headertemplate",t):t||this.removeAttribute("headertemplate")}get itemClass(){return this.getAttribute("itemclass")}set itemClass(t){this.setAttribute("itemclass",t)}get itemClassList(){return this.ht.itemClassList}get itemTemplate(){return this.K}set itemTemplate(t){"function"==typeof t?(this.setAttribute("itemtemplate","function"),this.K=t,this.ht.itemTemplate=t):"string"==typeof t?this.setAttribute("itemtemplate",t):t||this.removeAttribute("itemtemplate")}get listClass(){return this.getAttribute("listclass")}set listClass(t){this.setAttribute("listclass",t)}get listClassList(){return this.ht.listClassList}get open(){return o(this.Vt,"aria-expanded")}set open(t){t&&!this.disabled?this.rt():this.lt()}get readOnly(){return o(this,"readonly")}set readOnly(t){t?(this.setAttribute("aria-readonly","true"),this.setAttribute("readonly","")):(this.removeAttribute("aria-readonly"),this.removeAttribute("readonly"))}get searchable(){return o(this,"searchable")}set searchable(t){t?this.setAttribute("searchable",""):this.removeAttribute("searchable")}get value(){return this.ht.value}ct(){this.ut||(this.hasAttribute("src")?fetch(this.getAttribute("src")).then((t=>t.json())).then((t=>this.ft(t))).catch((t=>{throw new Error(t)})):this.ft(this.X))}lt(){this.Vt.setAttribute("aria-expanded","false"),this.ht&&this.ht.focusClear(),this.classList.remove("jt-open"),this.searchable&&(this.Vt.tabIndex=this.qt,this.zt.tabIndex=-1,this.zt.value="",this.ht.filter="")}bt(t){for(const s of t)if("attributes"===s.type&&s.target===this.X){if("disabled"===s.attributeName)this.disabled=this.X.disabled}else"data-key"!==s.attributeName&&(this.hasAttribute("src")||(this.lt(),this.ut=!1))}gt(){this.yt=!1,this.Jt=!1,this.Vt.parentElement.classList.remove("jt-focus"),this.ht.root.classList.remove("jt-focus")}Kt(){this.yt=!1,this.Jt=!0,this.Vt.parentElement.classList.add("jt-focus"),this.ht.root.classList.remove("jt-focus")}wt(){this.yt=!0,this.Jt=!1,this.Vt.parentElement.classList.remove("jt-focus"),this.ht.root.classList.add("jt-focus")}_t(){return{groupListClasses:this.groupClass?[...this.groupClass.split(" ")]:[],groupHeaderClasses:this.headerClass?[...this.headerClass.split(" ")]:[],itemClasses:this.itemClass?[...this.itemClass.split(" ")]:[],listClasses:this.listClass?[...this.listClass.split(" ")]:[],groupHeaderTemplate:this.W,itemTemplate:this.K,type:"single"}}Lt(t){if(!t)return null;if(t.includes("${"))return s=>d(t,{item:s});try{const s=document.querySelector(`#${t}`);if(s instanceof HTMLElement)return t=>d(s.innerHTML,{item:t})}catch(t){}return null}Wt(){this.open||this.disabled?this.lt():this.rt()}kt(t){const s=t.target;s instanceof HTMLElement&&null===s.closest(`#${this.p}`)&&this.lt()}Xt(t){!t.isComposing&&this.searchable&&(this.ht.filter=t.target.value)}Et(){this.Kt()}$t(){this.gt()}Ct(t){this.readOnly||this.Yt(t.detail.value),this.lt()}Mt(t){this.Vt.setAttribute("aria-activedescendant",t.target instanceof HTMLElement&&t.target.id||"")}Ht(t){t.relatedTarget instanceof HTMLElement?this.Vt.setAttribute("aria-activedescendant",t.relatedTarget.id||""):this.Vt.setAttribute("aria-activedescendant","")}Ot(t){const{key:s,altKey:e,ctrlKey:i,metaKey:n,isComposing:o}=t;if(o)return;if(!this.open&&["ArrowDown","ArrowUp","Down","Enter"," ","Up"].includes(s))return this.rt(),t.stopPropagation(),void t.preventDefault();switch("Backspace"!==s&&"Clear"!==s&&(1!==s.length||" "===s||e||i||n)||(this.searchable?this.open||this.rt(!1):1===s.length&&(this.open||this.rt(!1),this.Qt(s))),s){case"ArrowDown":case"Down":return this.ht.focusDown(),t.stopPropagation(),void t.preventDefault();case"ArrowUp":case"Up":return e?(this.Zt(),this.lt()):this.ht.focusUp(),t.stopPropagation(),void t.preventDefault();case"End":return this.ht.focusEnd(),t.stopPropagation(),void t.preventDefault();case"Enter":case" ":if(" "===s&&this.searchable)return;return this.Zt(),this.lt(),t.stopPropagation(),void t.preventDefault();case"Escape":return this.lt(),t.stopPropagation(),void t.preventDefault();case"Home":return this.ht.focusHome(),t.stopPropagation(),void t.preventDefault()}}rt(t=!1){this.disabled||(this.ct(),this.Vt.setAttribute("aria-expanded","true"),this.classList.add("jt-open"),t&&this.ht&&this.ht.focusSelected(),this.searchable&&document.activeElement!==this.zt&&(this.Vt.tabIndex=-1,this.zt.tabIndex=this.qt||0,this.zt.focus()))}Zt(){this.ht.focusedValue&&this.Yt(this.ht.focusedValue)}Yt(t){this.disabled||this.readOnly||(this.ht.value=t,this.ts(),this.lt(),this.dispatchEvent(new CustomEvent("change",{detail:this.value})))}ft(t){const s=new u(`${this.p}-listbox`,t,this._t());this.ht.root.replaceWith(s.root),this.ht=s,this.ut=!0,this.ht.root.addEventListener("item:click",(t=>this.Ct(t))),this.ht.root.addEventListener("item:focusin",(t=>this.Mt(t))),this.ht.root.addEventListener("item:focusout",(t=>this.Ht(t))),this.ss()}Ft(){if(!this.isConnected)return;if(this.hasAttribute("id")||this.setAttribute("id",this.p),this.X=this.querySelector("select"),!this.X)return;this.qt=this.X.tabIndex,this.Vt=document.createElement("div"),this.Vt.setAttribute("id",`${this.p}-control`),this.Vt.setAttribute("role","combobox"),this.Vt.setAttribute("data-role","control"),this.Vt.setAttribute("aria-controls",`${this.p}-listbox`),this.Vt.setAttribute("aria-expanded","false"),this.Vt.setAttribute("aria-haspopup","listbox"),this.Vt.setAttribute("tabindex",`${this.qt}`),this.Vt.addEventListener("click",(()=>this.Wt())),this.Vt.addEventListener("focusin",(()=>this.Et())),this.Vt.addEventListener("focusout",(()=>this.$t())),this.addEventListener("keydown",(t=>this.Ot(t)),{capture:!0}),this.St=i(`<button type='button' data-action='close' id="${this.p}-close" tabindex="-1"><span class='jt-sr-only'>Close Suggestion List</span></button>`),this.St.addEventListener("click",(()=>this.lt())),this.ot=i(`<button type='button' data-action='clear' id='${this.p}-clear' tabindex="-1"><span class='jt-sr-only'>Clear Input</span></button>`),this.ot.addEventListener("click",(()=>this.clear()));const t=document.createElement("div");t.classList.add("jt-control__buttons"),t.appendChild(this.ot);const s=document.createElement("div");s.classList.add("jt-control"),s.appendChild(this.Vt),s.appendChild(t),this.appendChild(s),this.zt=i(`<input id="${this.p}-filter" type="search" tabindex="-1" placeholder="Search Options" />`),this.zt.addEventListener("input",(t=>this.Xt(t)));const e=document.createElement("div");e.classList.add("jt-select__search"),e.appendChild(this.St),e.appendChild(this.zt),this.ut=!1,this.ht=new u(`${this.p}-listbox`,[],this._t()),this.ht.groupClassList.value=this.getAttribute("groupClass"),this.ht.headerClassList.value=this.getAttribute("headerClass"),this.ht.itemClassList.value=this.getAttribute("itemClass"),this.ht.listClassList.value=this.getAttribute("listClass");const n=document.createElement("div");if(n.classList.add("jt-popup"),n.appendChild(e),n.appendChild(this.ht.root),this.appendChild(n),this.open=!1,this.disabled=this.X.disabled,this.classList.toggle("jt-placeholder-shown",""==this.X.value),this.X.addEventListener("change",(()=>{this.classList.toggle("jt-placeholder-shown",""==this.X.value)})),this.X instanceof HTMLElement&&(document.activeElement===this.X&&this.Vt.focus(),this.X.style.display="none",this.X.id)){const t=document.querySelector(`[for="${this.X.id}"]`);t instanceof HTMLLabelElement&&(t.htmlFor=`${this.p}-control`,t.id||(t.id=`${this.p}-label`),this.Vt.setAttribute("aria-labelledby",t.id))}this.D=new MutationObserver((t=>this.bt(t))),this.D.observe(this.X,{attributes:!0,childList:!0,subtree:!0}),document.addEventListener("click",(t=>this.kt(t))),this.ct(),this.ts(),this.ss()}es(){const t=Array.from(this.X.selectedOptions).map((t=>t.value));(""===this.value&&0!==t.length||""!==this.value&&t.length>0||this.value!==t[0])&&(this.ht.value?Array.isArray(this.ht.value)?(this.X.querySelectorAll("option").forEach((t=>{t.selected=t.value&&this.ht.value.includes(t.value)})),this.X.dispatchEvent(new Event("change"))):this.ht.value!==t[0]&&(this.X.value=this.ht.value,this.X.dispatchEvent(new Event("change"))):(this.X.value="",this.X.dispatchEvent(new Event("change"))))}Qt(t){var s;"number"==typeof this.ns&&window.clearTimeout(this.ns),this.ns=window.setTimeout((()=>{this.J=""}),this.os||500),this.J+=t,this.J.length>1&&(s=this.J.split("")).every((t=>t===s[0]))?this.ht.focusTypeahead(this.J[0]):this.ht.focusTypeahead(this.J)}ts(){this.ht.value?(this.Vt.innerHTML=`<span>${this.ht.displayText}</span>`,this.classList.remove("jt-placeholder-shown")):(this.Vt.innerHTML=`<span class="jt-placeholder">${this.getAttribute("placeholder")||"&nbsp;"}</span>`,this.classList.add("jt-placeholder-shown")),this.es()}ss(){const t=this.ht.root.scrollWidth;0==t?setTimeout((()=>this.ss()),100):this.Vt.style.width=`${t}px`}clear(){this.Yt("")}constructor(){super(),this.J="",this.os=500,this.p=this.getAttribute("id")||s("jt-select")}static get observedAttributes(){return["groupclass","headerclass","headertemplate","itemclass","itemtemplate","listclass","src"]}attributeChangedCallback(t,s,e){switch(t){case"groupclass":this.ht.groupClassList.value=e;break;case"headerclass":this.ht.headerClassList.value=e;break;case"itemclass":this.ht.itemClassList.value=e;break;case"listclass":this.ht.listClassList.value=e;break;case"headertemplate":null===e?(this.W=null,this.ht.headerTemplate=null):"function"!==e&&(this.W=this.Lt(e),this.ht.headerTemplate=this.W);break;case"itemtemplate":null===e?(this.K=null,this.ht.itemTemplate=null):"function"!==e&&(this.K=this.Lt(e),this.ht.itemTemplate=this.K);break;case"src":this.lt(),this.ut=!1}}connectedCallback(){setTimeout((()=>this.Ft()),0)}static register(){customElements.define("jt-select",_t)}}"boolean"==typeof __ROLLUP_IIFE&&__ROLLUP_IIFE&&_t.register();export{p as JtAutocomplete,xt as JtPopupMenu,_t as JtSelect};
